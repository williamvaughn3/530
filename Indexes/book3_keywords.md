| Keyword | description | Page |
| --- | --- | --- |
| Next-Generation Firewall (NGFW) | Next-generation firewalls (NGFWs) are deep-packet inspection firewalls that move beyond port/protocol inspection and blocking to add application-level inspection, intrusion prevention, and bringing intelligence from outside the firewall."; basically, a firewall+++   Confusing, as lots of built-in capabilities and features   Effective and affordable | 3.4 |
| NGFW Capabilities | Intrusion prevention; Deep packet inspection;  Dependent on TLS interception; Network-based antivirus; DDOS protection; Malware sandboxing; User-based rulesets; TLS/SSH inspection; URL filtering;  Use as a web proxy;  Data loss prevention;  Threat feed block lists;  DNS filtering and sinkholing;  Reporting capabilities;  Strong logging support;  Geolocation rulesets;  Scripting/SDK support | 3.5 | 
| Deep Packet Inspection | Any capability that involves looking at more than IP header information falls under deep packet inspection.; <br> -  Intrusion prevention involves payload analysis.  Application control attempts to identify an application basedon ANY information.; <br> -  URL filtering and web proxy inspection dive intoHTTP/HTTPS.The term is oversold, but capabilities are not. | 3.6 | 
| Application control (NGWF) | analyzes payload data to identify common patterns or use cases to identify which application is in use. **application control signatures vary from vendor to vendor**; May require multiple characteristics to achieve high fidelity,| 3.7 | 
| Windows Update Example, Application Control NGWF | Multiple means toidentify WindowsUpdates; DNS; HTTP; HTTPSNot all are neededHTTP Host Name: download.windowsupdate.comSSL/TLS Server Name: www.update.microsoft.com | 3.8 |
| NGFW Rulesets | NGFW should allow all authorized connections.; <br> -  Allow authorized ports, applications, and countries.; <br> -  Achieve fine-grain control by allowing by subnet or user.; <br> -  And deny everything else.This is not a simple task.; <br> -  Many do not have a default outbound deny for ports.; <br> -  Where to begin? | 3.1O | 
| Rule Implementation Suggestions | 1. Port Based (Outbound deny), 2. Quick wins: URL Category Filtering, Deny all outbound by user/subnet, Enable Antivirus, Easy App rules, Geos, DNS Sinkholing, 3. Longterm: IP/FQDN by  buisn need, authenticate all outbound by subnet/user, URL allow lists, App rules for everything | 3.11 |
| Rule Counters | Start with getting to a port-based outbound deny ruleset.  Does not mean just start blocking stuff!A simple report can help identify all outbound ports.  May include ports for weird applications like FTP  Create allow rules for all destination ports.  Then create a default deny rule that is set to ALLOW.If default deny rule is hit, you are missing something.  Look at logs and add new allow rule (rinse and repeat). | 3.12 |
| TLS Interception | Encryption breaks deep packet inspection. - No application control - No antivirus - No intrusion prevention - Limited URL filtering; Many buy an expensive NGFW only to leave it blind. - **Chrome users spend 99% of their browsing time on HTTPS pages.** | 3.13 | 
| Quick Wins, NGWF | Network antivirus can be added in detection mode.; <br> -  Then flip to deny after cleaning up false positives.Block subnets/user accounts that do not need internet access.; <br> -  Users: Service accounts/privileged users; <br> -  Subnets: Servers/key workstations or devices; <br> -  Requires integration with authentication service(s); <br> -  LDAP/LDAPS or Active Directory most common | 3.14 | 
| Lock Down Basic Ports | Restrict simple ports to their corresponding applications.; <br> -   Such as ports 25, 53, 123, 465, 993, 995; <br> -   Some ports are intended for only one application.; <br> -   Port 53 UDP and TCP are dedicated to DNS.Single port outbound without restrictions = FAIL; <br> -   Would allow easy exfiltration; <br> -   And would allow easy infiltration; <br> -   i.e., allowing SSH outbound | 3.15 | 
| Geolocation Blocking | An organization may not have business in other countries.; <br> -  Yet default settings allow connections to and from them.; <br> -  Some regulations may request blocking sanctioned countries (see notes)Traffic has legitimate reasons to be in certain countries.; <br> -  Content delivery networks (CDN); <br> -  Cloud hosting; <br> -  Business partnersBlock specific countries; <br> -  Add FQDN or IP exceptions as necessary | 3.16 |
| External Dynamic Lists (EDLs) | sometimes referred to as Dynamic Block Lists (DBLs) or simply Dynamic Lists; <br> -  Allow to integrate dynamic threat intelligence feeds or other lists into NGFWs without requiring manual intervention <br> - EDLs can include IP addresses, URLs, or domain names (see https://opendbl.net/); <br> -  Can be used to block foreign VPN use, Team Cymru bogons list, etc. ; <br> -  Note vendors set limits to the number of EDLs and URL/Domain supported by each NGFW | 3.17 |  
| DNS Filtering and Sinkholing | Many NGFWs come with built-in DNS filtering capabilities and support for sinkholing. <br>-  DNS filtering allows us to block a domain name based on a predefined list or policy.<br>-  DNS sinkholing allow us to redirect requests to malicious domains to a controlled IP address (a "sinkhole") rather than being simply denied.<br>-  This is especially useful for malware analysis and containment, allowing us to extend protection time, while reducing detection and reaction time (remember TBS). | 3.19 | 
| Authenticated Internet Access (NGWF) | Restrict internet access to servers and critical assets.; <br> -  Ideally, block all outbound access.; <br> -  Support or troubleshooting may require internet access.; <br> -  Because of this, many organizations allow internetAllow authenticated access and block everything else.; <br> -  User rules and authentication rules are not the same.; <br> -  Malware chokes on authentication.Simple design = Prevention + Detection for the win | 3.2O |
| Application and Port Rules | Over time, move port rules to include applications; <br> - Challenge is mapping ports and applications; <br> - Application rules require no port or "the right" ports.; <br> - Confusing, as some vendors tie apps to individual rules and others attach security policies to rulesThe goal is to restrict all outbound access to ports and apps.; <br> - And to restrict those to specific IP addresses and FQDNs; <br> - Scripting and packet capture may help generate a list. | 3.21 | 
| Inbound Rules (NGWF) | Lock down all inbound service requests. Including ports, apps, antivirus, and intrusion prevention; <br> - Intrusion prevention helps against untrusted sources.; <br> - Monitor for performance being impacted (backups).; <br> - Tune or disable security services as necessary.Apply to lock down one system or application group at a time; <br> - It is ***not an all or nothing change*** | 3.22 |
| Scripting and APIs | Majority of NGFWs support automation; Using SDK and API interfaces; Or with commands via SSHAutomation is an architecture decision.; Firewall provisioning; Cleaning up or identifying unused address objects; Temporary blocks for incident response (careful); Automated troubleshooting | 3.23 |
| IaC | Uses declarative language to automate the provisioning of infrastructure to develop, deploy and scale cloud-based apps at great speed.; Allows repeatability, consistency andfaster deployments, with fullydocumented,versioned infrastructurethroughsystems like Git and CI/CD; Tools: Ansible, Puppet, Chefand Terraform; NGFWs can be provisioned andconfigured through IaC too | 3.23 |
| Terraform by HashiCorp | Terraform is a massive open-source project with tens of thousands of contributors. It's 'pluggable' by design; It enables to automate the provisioning and management of IaaS, PaaS and SaaS on Day 1, and Days 2+N; It does all of this using a 'declarative language' (HCL); It's like calling an Uber versus following Google Maps instructions | 3.25 | 
| NGFW on Cloud (1) | Most organizations will use a hybrid architecture that uses both cloud-compatible and on-prem firewalls, along with cloud-native network controls (i.e., security groups)<br> -   Most NGFW vendors have virtual appliances available in thecloud provider marketplaces<br> -   Many cloud-native network security controls are simpler(equivalent to stateful inspection firewalls) and workload-oriented controls, that complement rather than replace aNGFW Layer 7 virtual appliance:<br> - AWS security groups<br> - Azure network security groups<br> - GCP firewall rules | 3.28 |
| Network Security Monitoring (NSM) | Network security monitoring includes multiple aspects: - Asset discovery and identification <br> - Vulnerability identification <br> - Network intrusion detection (NIDS) <br> - Network metadata capture and analysis <br> - Packet capturesEach component adds a layer of strength;  Maturity of each component varies by implementation | 3.34 | 
| Alert-Driven Workflows vs. Data-Driven Workflows |    Most security operations teams live in an alert driven world; Alerts provide only the initial point for an investigation, but often additional context is needed to determine what to do next.; NSM provides additional data needed to pull a thread (go, hunt, explore) vs reactively waiting for an alert. | 3.35 | 
| Architecting for Network Monitoring Visibility | Out-of-Band (Option 1)Entire purpose is detection; Requires network tap or port mirror; Does not affect production; <br> Inline (Option 2)Purpose is detection and prevention; Traffic must go through IPS; Can affect production traffic | 3.36 | 
| Switch SPAN/Mirror Ports | Managed switches typically offer mirror ports; This functionality allows frames to be forwarded from one or more switch ports to another; Cisco calls these SPAN (Switched Port Analyzer) ports.<br> >Mirror ports offer organizations a simple way to sniff traffic, typically using existing equipment.<br> >Network taps (discussed next) are a better all-around solution, but mirror ports are reasonable for smaller environments; They also do not introduce another point of failure (as network taps can), which is a benefit.<br> >Switch mirror ports can sanitize traffic, dropping malformed frames (which may be used in Layer 2 attacks; This sanitization can blind IDSes to these attacks. | 3.37 | 
| Switch Mirror Port Overload | The switch on the rightis 1 gigabit (Gbps); Port 16 is the mirror port; Each port could send 1Gbps (both send andreceive) to the mirror port. <br> Switch port overload occurs when multipleports overwhelm themonitoring port; 15 x 1 Gbps traffic sent to a1 Gbps mirror port in theimage on the right | 3.38 | 
| Network Taps | Network taps offer a more robust network sniffing option  -Taps will send all frames to the monitoring port(s), including malformed frames.<br> -Higher-end taps offer tap buffers, which can cache traffic that bursts above the interface bandwidth threshold.<br> -Taps can present an additional point of failure, which should be considered; Some taps are designed to fail open in the case of a power outage: they will continue to pass traffic, but not send traffic to the monitoring interface(s).o  Higher-end taps have two power supplies, which should be connected to separate electrical circuits. | 3.39 |
| Network Aggregation taps | combine both duplexes and send to one monitoring port;  Lower-end taps send each duplex to aseparate monitoring port.; Multi-aggregation taps (shown on theright) send both duplexes to multiplemonitoring ports.; Allows sending traffic to separate IDSes, oran IDS and a full packet capture device, forexample | 3.4O | 
| Sensor Placement | Network monitoring is dependent on the location of network sensors. Value of the data and alerts that a sensor generates requires proper placement. <br> Network sensor between the internet and edge firewall provides visibility into external attacks as well as outbound traffic from an internal system. *Downsides*: external attacks will happen/not practical to investigate; the internal traffic would be visible but not with internal IP addresses, external IP of the edge firewall would show due to NAT. Could be useful for intel, but very noisy / high volume makes it gen. inpractical. <br> Configure each subnet that is visible to have Internal Outbound Monitoring, can ID C2, Malware activity, phishing, ect; <br> Intenral Monitoring is important, but often overlooked, can ID anaomalies and pivoting activity <br> . If the segmentation was done correctly, and the systems in each zone share similar attributes (OS, purpose, etc.), we will be able to tune those NSM sensors accordingly and avoid high false positives (FPs) and high false negatives (FNs)| 3.41 |  
| Security Onion | Linux distro by Security Onion Solutions, LLC; Full-fledged open-source network security monitor; With enterprise central management of sensors; Easily handles hundreds of NSM sensorsContains Zeek, Snort3/Suricata, full PCAP storage, and many other features and tools | 3.42 | 
| Packet Captures |  Network sensors listen promiscuously to network traffic.; Positioned well to see and store packet captures; Cost of hard drive costs is steadily decreasing; But does it really make sense today?; Does it scale in large environments?; Collecting full network traffic is very expensive in modern, large Enterprise environments. ; Are there any other choices beyond capturing network flows (low-resolution) and pcaps (high-resolution)? | 3.43 | 
| Behavioral-Based NSM with Zeek IDS | enhances network visibility beyond traditional signature-based detection through protocol decoding. ; IDS++: a Network Programming Language; Provides full context of all activity related to network events:; Which domains a host queries; Which TLS certificates are used; Which files are downloaded; Any FTP/SMTP/IRC/SQL activity, etc. ; Which user agents are usedProvides a flexible framework that facilitates customized, in-depth monitoring beyond traditional IDS | 3.45 |
| Zeek | is both an IDS and NSM in that it creates logs based on observability. It collects more than 400 data fields in more than 30 protocols. Requires sensor placement and network visibility | 3.46 |
| Power of Network Metadata;|  IDS signatures look for known bad; Network metadata is simply data.; Allows for learning the environment and identifying:; Abnormal events;  Unusual/newly observed/random domains or user agents; Unauthorized assets;  Computer DHCP but not in Active Directory or asset system; Vulnerable or misconfigured assets;  Old operating systems or applications on the network | 3.47 |
| Zeek and Network Visibility in the Enterprise | - Zeek is to the network what Sysmon is to the endpoint. It adds visibility to hybrid environments <br> - Zeeks metadata can be correlated with IDS alerts for additional context, enriched and consumed by SIEM/SOAR and other analytics platforms. | 3.48 | 
| Operationalizing Network Logs |  ***Decentralized via Scripts:*** Automation via scripts is low budget; Allows data manipulation; Custom alerting and actionsScripts can do:; Before-and-after comparisons; Newly observed domains 1; Apply data science; Discover C2 beaconing <br>***Centralized via SIEM:*** SIEM requires up-front labor and money investment,; Built for data manipulation; Built for automated alerting; Data science hooks built in; Correlate with disparate dataCapabilities similar to scripting; But purpose-built for analysis | 3.49 | 
| Security Onion Network and Endpoint Visibility |  New Elastic Stack and Kibana dashboards in Security Onion allow for easy pivoting between network and host data (analytical pivoting). | 3.5O |
| 400Gbps Intrusion Detection with Zeek |   Berkeley Lab Cyber Security Team has run a 100G-capable network monitoring system with Zeek since January 2015.  - Today, the Department of Energy's dedicated science network (ESNet) is monitored by Berkeley Labs network team using Zeek clusters across LAN and WAN links of 1-400Gbps (both IPv4 and IPv6 space) | 3.51 |
| Zeek Architecture | Zeek is not multithreaded, but its possible to scale by spreading the workload across many hosts using a cluster (worker + manager + proxy). <br> Allocate approximately 1 core for every 250 Mbps of traffic that is being analyzed. Architecturally, Zeek is layered into two major components. Its event engine and Script Interpreter| 3.52 |
| Zeek as a Command Line  Utility | Live or offline traffic analysis can be done from the command line by using the Bro binary: <br> ***zeek -i <network interface> <list of scripts to load>***  <br> ***zeek -r <pcap file> <list of scripts to load>*** <br> Example ***zeek -r /labs/3.2/capture.pcap /labs/3.2/analysis.bro *** <br> -C tells Zeek to ignore bad checksums (see notes) | 3.55 | 
| Using Zeek Scripting Language with a Zero Trust Mindset | The Zeek scripting language is inherently event-driven.; These events can be anything. Theres no notion of trusted or untrusted, internal or external. ; In this example, the ESNet team uses the Zeek script shown above with a Zero Trust mindset to detect both local hosts or services open to the Internet and Internet hosts/services open to the local network. | 3.56 | 
| Zeek File Extraction + Detonation Sandboxes | capable of doing automatic file extraction.; As files cross the network, Zeek carves them out.<br> File extraction and sandbox API submission = ***Full Automation***; Network sensors data gets a major boost.Detonation devices keep a record of each analysis.; Helps prevent repeat analysis and wasted resources; Tracking is done by keeping the hash of files and name of URLs. |3.57 |
| Visibility in Kubernetes with Zeek |  Kubernetes environments can be monitored with Zeek using a sidecar per monitored container.1; Once the traffic is mirrored, it may be analyzed at the sidecar (per container) itself or sent securely to a pod (on the same host) or to a central destination (different host) for analysis.; A monitoring sidecar-container can have as little as 0.25 vCPUs and 256MB RAM | 2.58 |
| Zeek Use Cases Spotting the C2 |  'Pulling a thread with X.509 certificates and DNS logs (example) | 3.59 | 
| Zeek Use Cases: TLS Magic with JA3 and JA3S |  JA3 and JA3S are TLS fingerprinting methods. ;   JA3 fingerprints the way that a client application communicates over TLS ;   JA3S fingerprints the server response;  Malicious self-signed certificates often have unique JA3 fingerprints.;  The way some C2 servers respond is unique too.;  These can be matched against known bad fingerprints. | 3.61 | 
| Suricata and TLS Magic with JA3 |  Suricata can also make good use of network metadata (in this caseJA3 hashes) even with a portless signature.; Detects Dridex1SSL Client Hello on a nonconventional TLS port | 3.62 |
| Zeek Use Case: Detect Beaconing with Machine Learning | Real Intelligence Threat Analytics, RITA from Active Countermeasures, can also ingest Zeek logs to detect beaconing, DNS tunnels, and query block lists. ; With the Python libraryZeek Analysis Toolkit (ZAT), you can extract data formats that can be read by ML packages from raw Zeek log files. | 3.63 | 
| Case Study: Tyrell Corporation (3)  - CloudNSM | fits well with Tyrell Corp public cloud as well:; EDR/XDR tools may not be available; Many VPCs have flat networks. NSM will provide visibility on them; Cloud API logs arent often designed for security monitoring ; MITRE ATT&CK Cloud Matrix coverage  ; Traffic mirroring must be set up | 3.65 | 
| Network Intrusion Detection | NIDS is primarily a "find evil"device.<br>Three main methods of detection;1. Signature-based; - Identify known bad patterns andcharacteristics.2. Anomaly-based; - Identify changes from baseline activity.3. Protocol analysis ; - Identify non-protocol/RFC specificbehaviors.<br>Signature and protocol analysis have fewer false positives. | 3.7O | 
| Signature-Based Detection | The power of signature rules is catching known: Command and Control activity (C2); Trojan remote control/backdoors; Policy violations and unwanted applications; Exploitation attempts; Network scanning; An indicator of compromise activity; Odd protocol use (can find unknown activity) | 3.71 | 
| Snort | the most common IDS.; Many commercial solutions use it.; Rule and rule format works on almost every IDS solution.; Contains built-in protocol analysis <br> Example signature rule:*alert ip any any -> any any (msg:"INDICATOR-COMPROMISE id check returned root"; content:"uid=0|28|root|29|"; metadata:ruleset community; classtype:bad-unknown; sid:498; rev:11;)* | 3.72 |
| Variables | Snort rules support and use variables.; Variables are declared with ipvar and portvar.ipvar HOME_NET [192.168.0.0/16,10.0.0.0/8,172.16.0.0/12]ipvar EXTERNAL_NET !$HOME_NETportvar HTTP_PORTS [80,8080]Most common IP variables are *HOME_NET* and *EXTERNAL_NET*; *EXTERNAL_NET* is commonly set to non-RFC1918 addresses; Doing so makes most rules miss internal -> internal traffic.; Alternative is to set EXTERNAL_NET to any | 3.74 | 
| Snort Rule Options | Rule options are within the parentheses. ***msg*** Specifies an alert message; ***content*** Finds patterns in the payload of the packet (Layer 7); ***metadata*** Additional information about the alert; ***classtype*** Categorization for the alert ; ***sid*** Unique identifier per rule (must be unique) | 3.75 |
| Snort gid | The gid number specifies what generates an event. **1** - General rule system, default if no gid is specified.<br> **100**+ Preprocessors and decoders; special capabilities built into Snort that are rarely modified by an organization<br> **116** - Snort decoder<br> **119** - HTTP Inspect preprocessor (Client)<br> **123** - Frag3 preprocessor<br> **129** - Stream preprocessorgid | 3.76 | 
| Metadata Logging |Suricata creates network logs.; DNS; Bidirectional flow data; HTTP; SMTP; TLS and more Means you have IDS alerts plus, context | 3.75 |
| Rules, Rules, and More Rules | Default systems often have over 10,000 rules available.; Snort with free rulesets is over 25,000.; Free and commercial rulesets are over 55,000.Maintaining rules on an IDS or IPS is a major task.; Too many rules lead to performance issues.; Or false positives/denial of service; Too few rules means lack of detectionor prevention. | 3.79 | 
| Pulledpork | ulledpork is a script that automates the download of new signatures and what to do with them, as well as existing signatures. It uses a combination of unique signature IDs, or SIDs, and regex to disable, change, or enable rules. | 3.8O |
| thresholds.conf | Rules with flowbits cannot be disabled by disablesid.conf. <br> Instead, thresholds.conf needs to suppress the rule. <br> **Example:** *suppress gen_id 1, sig_id 2019401* <br> Rules with flowbits are linked together to check the state of flow. | 3.81 |
| Default Configuration, IDS | Expect tons of false positives by default with IDS.<br> - Rules are developed for all organizations and assets.<br> - Rules are not customized to your environment.<br> - IPS rules are less likely to be false but still need testing.True power of IDS is customizing to your environment<br> - Adjusting rule priorities and changing/disabling rules<br> - Use signature rules to establish allow lists.<br> - Alerting on custom events like internal-to-internal traffic | 3.82 |
| Rule Priorities | IDS rule priorities default to classtype.; Example: misc-activity is set to 3 for low priority. APP-DETECT VNC server response Alert defaults to low priority; ***If VNC is not used, this should be a high priority, as it could indicate the adversary is using it to pivot (MITRE T1021.005***) <br> Changing this for all IDS rules = painful; Not changing means that you may need to ignore priority; Scripting can make this less painful. | 3.83 | 
| Catching the Pivot | Attack methodology often requires internal pivoting; Involves desktop -> desktop or desktop -> server traffic; Hard to detect without visibility <br> Network sensor must be positioned to see pivoting <br> *alert ip$WORKSTATION_NET any ->$WORKSTATION_NET any (msg:"Workstation to Workstation Traffic"; sid:5300000; rev:1;)* <br> *alert ip10.5.30.0/24 any ->10.5.40.0/24 any (msg:"HR Workstation to IT Workstation Traffic"; sid:5300001; rev:1;)* | 3.85 | 
| Alert Investigation | IDS/IPS solutions have *investigation workflows.; Alerts should be analyzed.; Results and findings should be recorded.* **Security Onion makes use of Sguil,Squert,and Kibana.**; All provide support for pivoting from alert to pcap. | 3.86 |
| investigation workflows | Alerts should be analyzed.; Results and findings should be recorded.* **Security Onion makes use of Sguil,Squert,and Kibana.**; All provide support for pivoting from alert to pcap. | 3.86 |
| SIEM Integration: Kibana | Integrating network logs with a SIEM allows for simpler workflow orchestration. At its simplest, a SIEM provides a central location for storing and searching log data. By having the data centrally collected and searchable, an analyst gains efficiency by being able to search across disparate data sources that are related. By having dashboards and third-party products integrated through a SIEM, analysis becomes less frustrating and less time-consuming. | 3.87 |
| EveBox | designed for Suricata.; Provides a web-based alertand event management tool; Uses alerts and metadata logs | 3.88 | 
| Secure Remote Access | Business needs often dictate the need for remote access. Most organizations have traditionally relied on a combination of technologies to allow and facilitate remote work <br> These include: Virtual Private Network (VPN); Terminal services and virtual desktop infrastructure (VDI); Secure Shell (SSH) ; Clientless RDP-SSH; Remote access applications; Cloud-based SaaS collaboration tools and services; *Implementation and security varies by protocol.* | 3.94 |
| Virtual Private Network (VPN) | Most organizations have VPNs today **Benefits:*** - VPNs are flexible for traditional remote work usage* - A VPN "tunnel" over the internet can be set up rapidly* - IPsec VPNs are most common in site-to-site VPNs while TLS VPNs are most used by mobile users due to its ability to traverse firewalls and NAT.* - Requires on-premises termination platforms (encryption is not end to end), configuration of clients and/or connectivity optionsV | 3.95 | 
| TLS VPN | Modern VPNs use TLS  Supports strong encryption such as AES256; Fast performance due to SSL/TLS use; Supports UDP or TCP (UDP may get blocked); Authentication support for user/pass/certificate ; Requires client or browser integrationTLS VPN usually supports post-authentication checks.; Such as antivirus and firewall verification; Similar to many commercial VPN solutions | 3.96 |
| Split Tunneling vs. Full Tunneling | Split-tunnel: Only specific subnets are routed over VPN.; Allows local traffic; Lowers bandwidth consumption; Increases the likelihood of external infection <br> Full-tunnel: All traffic must traverse VPN; Higher bandwidth consumption (central point of internet traffic); All traffic funnels through centralized security solutions.;Acts as if the system is plugged into the corporate network;Cannot access local resources such as IP printers | 3.97 | 
| Always On VPN | One approach is to use full-tunnel mode with Always On VPN clients; Allows mobile devices to be handled similarly to desktop; Available on Windows 10 or later as Microsoft Always On VPN <br> **Requires storing password or certificate** on each system for computer startup (versus 'user-initiated tunnel')As soon as internet access is available, VPN connects home.; Deployment can be automated at build time or after the fact.; The endpoint is restricted from disconnecting from VPN.; Compression and client-based WAN optimization can limit the bandwidth consumed at thecentral location.; 'Always on' VPN tunnels don't have to use full tunneling. | 3.98 |
| VPN Compression and WAN Optimization | slide demonstrates testing performed under three scenarios. In all the scenarios, MP4 videos were streamed over the internet | 3.99 |
| Post-Authentication Checks | Is similiar to NAC. Many VPN clients support post-authentication checks; Most common is to check antivirus and firewall <br>O ther possibilities; Vulnerability scan with automated remediation; Patch verification with automated remediation; Custom scripts (look for new running processes); A user associated with the new asset (require approval); **Longer an asset has been disconnected, the more checks need run** | 3.10O |
| Rethinking VPN Strategies | COVID-19 and the use of SaaS applications made many organizations rethink their VPN strategy; Many are implementing VPN split tunneling for Office 365 and other pre-approved SaaS based applications to optimize traffic; Also, to deploy patches without forcing all traffic back into the corporate network; Always conduct a risk assessment before adding exclusions to your existing forced tunnel (i.e., do I have all the necessary additional controls in place?); Cisco, Palo Alto and F5 configuration guides for optimizing split-tunnels for Office 365 are included in the notes.; What other alternatives to VPN we have? | 3.101 |
| Remote Access Applications | VPNs are not the only means of remote access. Applications or other services common for remote access; Remote desktop and applications like GoToMyPC <br> Remote desktop uses built-in Remote Desktop Protocol (RDP).; Supports external use and multiple users via terminal services; Built for Windows and uses *TCP port 3389* <br>Other remote access methods similar to SSL/TLS VPNs; Agent installed may create a reverse tunnel to cloud **service | 3.103 | 
| Block Remote Access Programs | All unauthorized remote access programs need to be blocked; These are not only policy violations, but they are also often abusedby threat actors (MITRE ATT&CK T1219) <br> Use application control, FQDN blocking, or sinkholing <br> Expect to find many remote access methods.; Common to find 10+ methods (shadow IT or policy violations); Focus on more than installed programs | 3.104 | 
| Remote Access Risks | Remote access servers are targets for server-side attacks.; Examples: RDP exploits such us BlueKeep1 , RD Gateway 2, etc.; Requires routine patching and deep packet inspectionRemote authentication needs to move past passwords.; Password spraying and brute forcing are too common.; Password-only authentication to the internet is a bad idea. | 3.105 | 
| Architecture Fail of Passwords | **Option-1, Dictionary Attack**: Attacker uses password lists<br>Tries all combinations per user list<br>May get blocked after X failed attempts <br>**Option-2, Password Spraying**: Same but one try per user before rotating<br>May get blocked by source IP after X failed attempts <br>**Option-3, Botnet tunneling** : Same as #1 or #2 but source changes per attempt | 3.106 |
| ProxyCannon | Emulates a private botnet using Amazon EC2; Automation script to deploy new Amazon instances <br> - Supports rotating instances every X time period <br> - Tunnels all traffic through Amazon instances - Traffic load balances among instances; Example: Password spray attempts would each come from a different instance.; Defenders can use for testing   Helps identify detection/prevention/response abilities | 3.107 | 
| Alternatives to VPN: ZTNA and SDP |  VPN provides access to a network. Access is often overly permissive, grantingremote workers access to more of the network that is needed. <br> Zero Trust Network Access (ZTNA) or Software Defined Perimeter (SDP)provides access to an application or resource, taking an identity-based, zerotrust approach that enforces a custom policy for each user device. Each connection istreated as untrusted and veri�ed continuously. <br> Ideally, organizations should be moving toward a ZTNA solution, but you will haveto coexist with VPN access for a while. <br> Your goal should be moving toward ZTNA/SDP for most of your users, and partnersaccess, while maintaining well tuned and secure VPN access to only bring clientsinto the network when necessary. <br> Other alternatives including cloud-based VDIs, or Desktops as a Service (DaaS) arebecoming increasingly popular (i.e., NICE DCV or Azure Virtual Desktop). | 3.108 | 
| Remote Desktop on HTML5 with Apache Guacamole | Apache Guacamole is an open-source clientless remote desktop gateway that supports RDP, SSH, and VNC through HTML5 and WebSocket. <br> Supports RADIUS, LDAP, 2FA (TOTP, Google Auth, Duo, etc.) with load balancing and more<br> SSL/TLS termination can be achieved with Nginx in front of it. <br> It can be deployed using docker. | 3.109 |
| Controlled Network Authentication | Remote access means more than external access - Internal to internal access needs to be controlled (remember presumption of compromise). <br> How privileged access is used on the network matters. <br> The goal is to prevent/detect lateral movement. <br> Constructing the attack paths can be done manually by reviewing permissions, group memberships, etc. or by using a tool such as **BloodHound** or **PingCastle** <br> Multiple options for controlling remote access: Administrative workstations, jump boxes, and identity access management (IAM) solutions | 3.11O |
| Clean Source Principle (CSP) and AD Management |   When assessing how much **implicit trust** we have in our internal environments, we should consider the Clean Source Principle. <br> - CSP states that a system can be dependent on a higher trust system but not on a lower trust system.<br> - This means that you should identify all objectssecurity dependencies and make sure that they are as trusted as the object you are trying to secure.<br> - While simple in principle, this concept gets complex easily in the real world as most enterprises grow organically.<br> - In Section 4, we will cover additional data-centric strategies including privileged access. | 3.111 | 
| Common Attacks with Lateral Movement | Primary issue around remote access is credential theft and reuse; Malware/adversaries highly successful at stealing credentials; Credential on disk or in RAM <br> <br> Cleartext password retrieval; Mimikatz1; LSA secrets; Saved passwordsHash dumping/token smuggling| 3.112 | 
| Administrative Workstations | Credential theft is high risk on workstations with: Users that have administrative rights; Users that use browsers and mail clients on system; <br> Recommend using administrative workstation design; Or separate workstations for separate tasks<br> Administrative workstations are locked down.; Only standard user access; Or depending on risk tolerance, should be an admin with separate user; No productivity applications | 3.113 | 
| Jump Box Connection Options | **Remote Desktop**: RDP used for web and internet: Limits compromise to RDP server: Limits credential theft to the standardaccount:  Assumes email is not sensitive <br> RDP used for admin tasks: Limits physical security risks of theadministrative workstation | 3.114 |
| Jump Box, Local  |Possible to localize jump box with virtualization; Potential risk of VM escape; Attacker compromising host from within VMPhysical host needs to be the secured OS; Productivity applications should be in VM; Compromise of host = compromise of VM <br> Host OS has full access to VM disks and full memory visibility | 3.116 |
| Jump Boxes, Controlled Authentication | Purpose-built remote access allows prevention and detection <br> Example: Domain admins must come from the jump boxConsider network activity from productivity systems internally <br> Should be highly limited and exceptions = SUSPICIOUS <br> The concept works well with non-IT staff and IT staff. | 3.117 |
| Bastion Host on Cloud VPCs| Bastion hosts (also called jump servers) are usually used in cloud environments to access the private resources<br> You should use existing hardened templates. Dont create them from scratch. <br> While bastion hosts offer some protections, they are still vulnerable because they rely on the security of the administrator workstation accessing it. If an attacker compromises this workstation, the attacker can also control the bastion host.<br> These can be replaced with CSPs native remote access services i.e. (AWS Systems Manager and Session Manage) to avoid opening ports. | 3.118 |
| Identity Access Management (IAM) | IAM is often used for federation and single sign-on (SSO); Allows centralized authentication with the federation; Allows one login to work with multiple systems (SSO); Can be dangerous without timeouts or requiring login for critical appsSolutions can also be used for custom authentication workflows | 3.12O |
| Case Study: Tyrell Corporation; A Hybrid Architecture | To assist with our journey towards Zero Trust, Tyrell Corp will look at a hybrid architecture that will:<br> Maintain traditional VPN tunnels to on-prem resources for IT/Security staff, balancing remote usability with risk of compromise. <br> Implement ZTNA-like solutions to access cloud-based applications.<br> Implement jump boxes both on-prem and in the cloud to control the flow of traffic and add additional authentication and SSO.<br> Both solutions should allow flexible authentication policies using strong device and user authentication, MFA, and integration with directory services like AD and SSO. <br> Both solutions should allow for continuous monitoring to detect unusual behavior that could indicate a compromise. | 3.123 | 
| Modern vs. Legacy Authentication | **Modern authentication**: Strong authentication: using MFA with or without passwords. Often includes the Fast Identity Online (FIDO) standard and passwordless; Identity federation: between parties using SAML, OAuth and OpenID Connect (OIDC); Validation: on-login and in-session risk assessment; **Legacy authentication:** Basic and Digest authentication; NTLM and Kerberos; Relies on separate accounts rather than federated access; No continuous validation built into the protocols or authentication flows | 3.125 | 
| Multi Factor Authentication |** should be required in all cases**!; Prioritize privileged access or accessing critical infrastructure,data, or services;   Direct MFA push should be completely disabled with privilegedusers.Form of authentication should be mixed (two or more);  **Something you have**: Token (OTP), Smartcard, FIDO U2F;  **Something you know**: Password or PIN;  **Something you are**: Fingerprint, retina, and facial pattern | 3.126 |
| HMAC-Based and Time-Based One-Time Passwords | HOTP uses a secret key and counter to generate an HMAC. HMAC = Hashed Message Authentication Code Counter is an 8-byte value that changes with each use<br> TOTP involves generating a password that rotates based on time. Password typically rotates every 3060 seconds Algorithm uses time since epoch and a shared secret key Same as HOTP but uses time for counter <br> Physical tokens or universal 2nd factor (U2F) devices use HOTP or TOTP. | 3.127 |
| Google Auth | Free multifactor for the world; Requires a Google accountSupports code via SMS, voice call, or phone app; Can also integrate with physical U2F security keysOnline documentation allows for integration with systems.; Windows WinAuth2agent; Linux Requires Google Authenticator PAM module; VPN Solutions  Most vendors support integration.; Apache Guacamole | 3.128 | 
| Fast Identity Online (FIDO) | An open industry association with a mission to reduce the world's reliance on passwords ;FIDO's two main protocol specifications are UAF (Universal Authentication Framework) and U2F (Universal 2nd Factor). ;FIDO2 includes WebAuthn and CTAP to enable passwordless | 3.129 |
| Adversary-in-the-Middle (AiTM) Phishing |   FIDO2 keys (i.e., Yubico keys) can help defend AiTM attacks.; Adversary-in-the-middle (AiTM) phishing attacks are used for bypassing multi-factor. AiTMattacks complete the authentication process and capture the token.; Phish-resistant sign-in methods like FIDO2 keys, certificate-based auth and Windows Hello can help to prevent these attacks. | 3.131 |
| MFA fatigue | is a type of cyberattack that attempts to overwhelm users with requests for multi-factor authentication (MFA) codes. The goal of this attack is to trick users into approving fraudulent login attempts or transactions.These attacks are typically carried out using automated scripts that send repeated MFA requests to users. Attackers may use a variety of methods to obtain the users' email addresses or phone numbers, such as phishing attacks or data breaches | 3.133 |
| OAUTH 2.O | OAuth 2.0 standardizes the process for third-party applications to access user data without exposing the user's password. <br> Some of the most popular attacks include: OAuth token theft; Device Authorization Grant Phishing; Consent Phishing Attacks | 3.134 |
| Defending against the OAUTH Consent Phishing | Enable the option to require Admin consent in Azure Active Directory when users try toconsent to applications that are not from a verified publisher. This makes sure that the admins investigate any risky app before granting the consent.<br> Review the consent screen carefully before granting permissions to any app or service.<br> Avoid granting permissions that are excessive or inappropriate for the app's functionality. <br> Monitor used applications and revoke permissions from any apps or services that you nolonger use or trust. You can do this by visiting enterprise applications area in Azure AD or the OAuth section in Defender for CloudApps. <br> Alternatively, you can create an OAuth policy in Microsoft Defender for cloud apps to notify you when a user consents to risky applications based on the level of permission that theapplication requires, how common it is within the organization or even the exact permissionthat the app requests. | 3.136 |
| Identify Federation and Single Sign On (SSO) | Although there is some overlap, below are very simple ways of distinguishing three protocols. <br> **OpenID**: single sign-on for consumers2. <br> **SAML**: single sign-on for enterprise users <br> **OAuth**:API authorization between applications <br> SAML, OAuth and OpenID all facilitate different intentions via a common underlying mechanism, which is redirection to a service provider/identity authority for some private interaction, followed by redirection to the originating third party app.| 3.137 |
| Network Encryption | Many prevention/detection techniques require visibility.; By design, encryption hides payload data.; Encrypted data only readable at the endpointEncryption is a tool.; Used for good, it secures traffic.; Used for evil, malware goes undetected or trusted.So, is encryption a good thing or bad thing?; Answer: Depends on your architecture | 3.139 |
| Secure Transmission | Network encryption is designed to secure communication.<br> - System A talks to System C.<br> - System B cannot tell what A and C are sending. Network encryption uses established hierarchical trust.<br> - System A trusts C because it is signed by trusted server D.<br> - The hierarchy provides trust, which is another security boon. | 3.14O |
| Encryption Issues |  Malware routinely uses encryption.; Phishing sites are commonly encrypted.; Malware uses TLS to communicate to C2 servers.; Encryption breaks current investments.; Cannot see data exfiltration; Cannot see or analyze malware; No application control; IDS/NSM visibility significantly less | 3.141 |
| Leveraging Encryption |  Industry push is to encrypt everything; Concept increases risk rather than reducing it; Encryption should be deliberate and calculated.<br>Encryption considerations:; Is end-to-end encryption necessary?; Is encryption implemented securely?; Is inspection allowed?; Is strong crypto support forced? | 3.142 |
| Lets Encrypt | The internet is moving toward 100% encryption. <br> Standard sites do not want to buy certificates.Lets Encrypt1is a free, automated, and open CA. <br> Based on non-profit crowdfunding <br> Provides automated certificate issuance and renewal <br> Certbot automates certificates and hardens configuration. <br> Domain validated (own a DNS domain = free certificate)Already is being used for evil <br> Malware can easily have a trusted certificate. | 3.144 | 
| HTTP Strict Transport Security (HSTS) | Many websites support HTTP and HTTPS. <br> Done for performance but can greatly affect security <br> Switching between HTTP and HTTPS is insecure. <br> Information leakage (cookies, session tokens) and MITMHSTS fixes the above issues (requires setting HTTP header). <br> Upgrades HTTP links to HTTPS automatically <br> Disables ability to click through invalid certificates <br> Removes the ability to downgrade site access to HTTP | 3.145 |
| sslstrip | sslstrip1is a tool written by Moxie Marlinspike: Requires victim machine caught in a MITM attack; Then performs downgrade attacks on HTTPS; Supports padlock favicon to make folks feel more secureWorks because users browse the internet via google.com; Rather than https://www.google.com; Why browser site identity button is now used; ***One of the reasons HSTS was born*** | 3.146 |
| HSTS Preloading | The default behavior is that HSTS site must be accessed once Major browsers support HSTS preloading. <br> HSTS preload lists enforce HTTPS even on first access.Requirements for HSTS preloading: <br> The header must include subdomains, age over 1 year, and preload. <br> *Strict-Transport-Security: max-age=31536000; includeSubDomains;* ***preload*** <br> The site must redirect from HTTP to HTTPS. <br> Verify site is working, then submit a domain to hstspreload.org | 3.147 | 
| Certificate Transparency Monitoring| Certificate authorities are expected to generate public logs.; Means a public log is available per certificate issued; The goal is to require support for certificate transparency.Provides near real-time notification of new certificates; Vendors offer commercial integration and monitoring.1; Facebook provides free certificate transparency monitoring. | 3.148 | 
| Certificate Authority Authorization (CAA) | Certificates should only be generated by trusted CAs.<br>CAA uses DNS to limit which CAs can issue certificates.<br>Domain validation authorizes specific CAs for domainCAA requires a simple DNS record to operate (RFC 6844) <br> Use multiple CAA records to authorize multiple CA | 3.149 | 
| Crypto Suite Support | Different devices/software support different algorithms. <br> Cipher suites are the encryption algorithms supported. <br> Examples: TLS_RSA_WITH_RC4_128_MD5 and TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521 <br> Weak ciphers can be exploited by adversaries. <br> Malware may use abnormal or old ciphers.Modern operating systems allow selection of ciphers <br> Windows via registry keys1and Linux via configuration files <br> **Zeek logs can help identify what algorithms are used on the network.** | 3.150 | 
| Qualys SSL Labs | Web servers need to be hardened for proper encryption.;Disable SSL support;Fine-tune cipher suites;Enable proper headers ;Such as HSTS and HPKP;Harden SSL/TLS settingsQualys SSL Labs1scans and grades SSL/TLS settings.;Recommendations provided to improve the score | 3.151 |
| SSL/TLS Passive Decryption | Proper certificate establishment and use is important. <br> But so is maintaining security capabilities and visibility.Depending on the encryption method, decryption is possible. <br> Packet captures can be decrypted with Wireshark.1 <br> Tools like viewssld2can decrypt data on the fly.Passive sniffing has a high fail rate for decryption. <br> Perfect forward secrecy (PFS) breaks passive decryption. <br> Many internet sites use PFS. | 3.152 | 
| Perfect Forward Secrecy (PFS) | PFS negotiates an encryption key using Diffie-Hellman.; Symmetric key changes per client/server session; Even if the private key is compromised, prior sessions are unlikely to be decrypted. | 3.153 | 
| Network Analysis Core Concept: TLS 1.3 |  TLS 1.3 is the latest version of the TLS protocol, dropping support for older, less secure cryptographic features and speeding up TLS handshakes, among other improvements. <br> TLS 1.3 is widely used, becoming the chosen encryption protocol for most web servers among the top million. | 3.154 |
| Network Analysis Core Concept: Differences between TLS 1.2 and 1.3 | TLS 1.3 is faster requiring only one round trip instead of two, cutting down latency. In TLS 1.3, vulnerable algorithms have been removed, including RSA and any static, non-PFS key exchanges. Everything after the server hello is now encrypted, including the X.509 certificate | 3.155 |
| SSL Inspection | Security devices like NGFW or web proxies support SSL inspection.; - Functions similar to a proxy serviceSecurity device acts as a trusted CA to internal devices; - Issues certificates per site accessed; - Fixes visibility issues such as PFS blindness; - Requires systems to trust security device as CA | 3.156 | 
| SSL Decrypt Mirroring |Modern devices with SSL Inspection also support SSL decrypt mirroring.; Decrypted packets are mirrored out an interface; Puts NSM/IDS back in the game <br> Decrypted traffic shows up withthe original port, such as 443.<br>But reflects decrypted data<br>IDS should include 443 in $HTTP_PORTS.| 3.157 | 
| Risks and Cons of  TLS Interception | There are a number of risks and cons associated with TLS interception, including:<br>Increased attack surface: If the TLS interception system is compromised, attackers could gain access to sensitive data, such as passwords, credit card numbers, and other personal information.<br>Increased management overhead in part due to the increasing use of certificate pinning in mobile apps. Over 11% of iOS apps use cert pinning according to a study, and the number is increasing. | 3.159 | 