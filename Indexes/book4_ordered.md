| Slide | description | Page |
| --- | --- | --- |
| Know Thy Org | A defensible architecture requires organizational awareness. - What are critical assets? - Where are the critical assets? - Why are they considered critical assets? - What do these assets need to function?Knowing the above questions allows defenses to be built.; Network-centric defenses build a security moat.; Data-centric defenses secure the treasure in the castle. | 4.4 |
| Full Stack Security in Monolithic Applications | Applications rarely involve a single component; More likely multiple services make up one appConsider a custom web application; May utilize an application server; Such as Java, Cold Fusion, Tomcat, or JBos; Uses a web serve; Stores and retrieves data from a database serverSecuring application means securing the stack | 4.5 |
| How About Microservices | Instead of having every resource in the same code base, each service exposes an API that can be used by another service.The APIs can be RPC-based, REST, etc.Their security depends on the security of all the services.Later in this section we will consider how to defend these environments through a strong API security program. | 4.6 |
| Application Problem | Custom applications/websites are problematic. -Prior technologies like deep packet inspection fail. -No signatures for custom applications -No application control for custom applicationsThere is a need for custom security integrations. -Turnkey solutions do not exist for custom applications. -Products are available but require lots of adjustments. | 4.8 |
| Web Application Firewalls (WAF) | "A web application firewall (WAF) is an application firewall for HTTP applications."1OWASP; <br> Name implies simple to use prevention technology; <br> A WAF is completely different than traditional firewalls.; <br> WAF is a reverse proxy or local module on a web server.WAF technology is helpful given:; <br> Custom web applications do not have patches; <br> Centralized security application of web servers is needed | 4.11 | 
| OWASP Top 10, WAFs | WAF has strong focus on mitigating OWASP Top 10; List of 10 most critical web vulnerabilities; Such as injection and broken authentication or access controls; Perfect worldall code would be secure; Yet web applications are increasingly targeted. According to 2023 Verizon Data Breach Report, web attacks remain the 2ndmost common breachpattern. IPS or NGFW mitigate basic versions of the top 10 attacks.; But are not designed to handle HTTP as deeply; Due to complex payloads using the HTTP protocol | 4.12 |
| Reverse Proxy | A reverse proxy handles incoming requests.; Then routes them to appropriate backend service; Clients are not aware of reverse proxyCan be either an on-premise solution or cloud solution; All major CSPs have cloud-based WAF solutions | 4.13 |
| DDOS Scrubbing, WAF |  Commercial cloud WAF solutions offer DDOS scrubbing.; Scrubbing is a cloud service for preprocessing data.Simplest form is using DNS to route traffic first to cloud serviceCloud service integration possible at the enterprise level as well; Often consists of BGP and/or GRE tunnel integration; Can always be on or dynamic, but goal is to route traffic to vendorCloud Service | 4.15 |
| TLS Offloading | Reverse proxy design often includes TLS offloading.Clients establish TLS connection to reverse proxy; Then reverse proxy establishes connection to server using HTTP; End-to-end encryption is supported.Proxy inspection has full access to every request and response.; Similar to TLS inspection on NGFW but with fewer politics | 4.16 |
| modSecurity | is an open-source web application firewall; Can be deployed as reverse proxy or local to serve; Allows for fine-grained control and do-it-yourself WAFCommercial solutions provide a nice GUI to work with; But may not be as flexible as ModSecurit; Rule syntax format as follows: *SecRule VARIABLES OPERATOR \[ACTIONS\]; <br> Example: *Deny Empty Host HeaderSecRule REQUEST_HEADERS:Host "^\$" "deny,phase:1"* | 4.17 |
| WAF Challenges | WAF is not completely foolproof. Methods exist to identify a WAF is in place (fingerprinting). Multiple techniques exist to bypass WAF security. <br> Potential WAF issues: Each web server reacts differently to various requests. Many encoding techniques exist that are valid. Operating systems interpret paths differently. Reference evasion article |4.18 |
| Evasion Example | ***SecRule REQUEST_FILENAME "@streq /admin.php" \"chain,phase:2,deny" SecRule ARGS:user "!^[a-zA-Z0-9]+$"*** <br> Rule looks for request to /admin.php with invalid user parameter; If user field does not match regex, deny the request; Bypass examples: */./admin.php, /abc/../admin.php, /./abc/../admin.php/, admin.php/abc/ADMIN.php, /AdMin.php* | 4.19 | 
| WAF Normalization | A WAF should attempt some level of normalization:; Against paths, variables, and everything else: <br> *SecRule REQUEST_FILENAME "@beginsWith /admin.php" \"chain,phase:2,t:none,t:normalizePath,deny"* <br> *SecRule ARGS:user "\!\\^\[a-zA-Z0-9\]+\\$\"* <br> @beginsWith allows path to include other valid data like PATH_INFO.<br> **t:normalizePath **tries to abstract encoding and evasion techniques from path.Recommended read: Ivan Ristic has great article on evasion called Protocol-Level Evasion of Web Application Firewalls1 (paper is defense-oriented) | 4.2O |
| WAF Protocols and Technology Support | Web application firewalls are fairly mature.; Yet new protocols may not be supported by every vendor.; For example, many WAF solutions still do not support WebsocketsNeed support for newer protocols or technologies in use; Includes protocol support (HTTP 3.0/QUIC, WebSockets); Application content types (XML/JSON)WAF should include all capabilities your custom applications use | 4.21 | 
| WAF Allow Listing | Default configuration is to deny list known evil;  Far more secure to only allow what is expected <br> Parameters  User ^[a-zA-Z0-9]{3,50} <br> Password (length >= 8, any characters, escape <br> Cookie  SESSIONID ^[a-zA-Z0-9_-]+ <br> URIs: /index.php (max_uri length = 10, no entry points) <br> /login.php (max_uri_length = 10, user/passwordentry points) <br> /weather.php (max_uri_length = 22, zip entry point) | 4.23 | 
| Central Web Server Protection, WAF | A key advantage of WAF is centralized protection.; Possible to apply security policies across web servers; Examples: Add HSTS headers; Fine-grained control of error pages; Content routing; Multifactor authentication integration; CAPTCHA and rate limiting; Third-party scanner integration | 4.24 | 
| Web Vulnerability Scanner Integration | Vulnerability web scanners are specific to web servers; Enterprise scanners can integrate with a WAF; Example: Acunetix, HCL AppScan, Invict; Process can be automatic or manualVulnerability reports can be imported into WAF solutions; Provides virtual patching of vulnerabilit; Automatic integration geared toward minimal false positives; *Which means vulnerability may still be exploitable* | 4.25 | 
| Virtual Patching | Businesses push developers to build sites and move on.; As a result, websites tend to stay vulnerable. Virtual patching uses a WAF to mitigate the risk without recoding the application.; True fix is to fix the vulnerable code; Virtual patching should be temporary.;  Often ends up being permanent; Problem is bypass may be possible | 4.26 |
| Moving Past Allow/Deny | Action against clients is not limited to allow or deny. - Dynamic actions can be taken. <br> The higher the risk identified, the more restrictions applied - High traffic rate pops a CAPTCHA request. - Odd character submissions require email validation to continue. - Account or checkout lockouts requiring a phone call or chat | 4.27 |
| Content Routing. WAF | can dynamically route traffic among web servers.; Capability intended for performance and load balancing; Can be used to add content to existing servers virtually; WAF is also capable of modifying requests/responses on the fly. | 4.28 |
| WebLabyrinth | is a PHP application that infinitely creates webpages.; Design is to confuse or break automated scanners; Supports automated alertingNormally would require setup on each server and require PHP; WAF can integrate WebLabyrinth into every web serverWorks best with robots.txt | 4.29 |
| Traditional Web Security vs. API Security | Traditional Web Security, Castle and moat approach; Incoming requests will adhere to well-defined protocols that are mostly static; Clients will be using a web browser; Attacks can be detected by examining the requests <br> API Security; The castle has lots of openings, and no moat; Incoming request formats can change frequently; Clients will probably not be using a web browser; Attacks are not necessarily detectable within the incoming requests | 4.3O |
| WAAP Web App and API Security | New web architectures require new WAF technologies.WAAP solutions combine the traditional WAFs capabilities discussed earlier, with advanced API features like discovery of web applications. | 4.32 |
| open-appsec | is a new WAAP open-source initiative powered by a supervised and an unsupervised machine learning model It can be deployed as an add-on to Kubernetes Ingress, NGINX, and API Gateways. The virtual labs are great to experiment in a simulated environment. | 4.33 |
| Runtime Application Self-Protection (RASP) | While WAF protects the applications from the network, RASP provides protection from the **inside** of the application itself. RASP complements  WAF as an additional data-centric control in a defensible security architecture. RASP are deployed as an agent or linked library that secures an individual application in real time, becoming part of the application, thus potentially affecting application performance. | 4.34 |
| WAF Detection | detection capabilities outweigh prevention.  Public sites are going to be attacked; Detection helps identify who, what, whereBest detection capabilities are for On-prem Server; Near impossible to attack a web server without flaggingWAF prevention will ultimately fail, so detection is a must. | 4.35 | 
| Database Monitoring and Controls | Critical data is often stored in a database. - Database security is different than web security.Database security primarily deals with: - Controlling who can access data - Applying limits to data access - Identifying sensitive data locations - Heavy detection focus | 4.41 |
| Database Logging | Most databases have logging disabled by default; May have generic service logs but missing logs on who did whatBuilt-in logging capabilities can be enabled.**Change tracking**: Record change logging; **Common compliance criteria**: Success and failure events; **Trigger logs**: Custom logging events; **Query logs**: Record SQL statementsEach can cause performance issues.; Logs are difficult to deal with and miss key information. | 4.42 |
| Database Security | Built-in security is decently strong.; Supports local or centralized authentication; Access can be restricted to databases, tables, or columns.;  Some databases even support record-level access.; Supports groups and custom roles; Defines ownership and privilege grantingUsually, supports custom views; Stored query to limit visibility | 4.43 |
| Database Security Issue | Databases are commonly paired with web servers.;  Web server can pass-thru user authentication to database; But it is common for a service account to be used.Creates a key security issue; User1 logs into web server to run report; Web server logs into database with svc_webserver; What privileges and access does User1 have? Either requires changing to pass-thru or custom code| 4.44 |
| Content Discovery | Securing data requires knowing where data resides. Certain fields usually intended for sensitive data *SSN, credit card numbers, driver's license*;  Other fields are not supposed to but have sensitive data, *Comments, additional info, notes*;  You must perform content discovery on a regular basis. Involves crawling through databases and filesystems looking for data where it should not be | 4.45 |
| Data Masking | Possible to show partial matches or entirely mask data; Data masking hides actual values from certain users.One user sees social security number 123-45-6789 The second user sees social security number XXX-XX-6789 <br> Masking allows certain business processes to continue.; While potentially limiting risk of stolen dataProblem is many database solutions do not support masking; And service account use interferes with masking implementation. | 4.47 |
| Record Limits | Large data breaches are occurring more often; Commonly a web service with massive database stolen; Zeek can provide traffic monitoring and integrate with a SIEM (example: mysql.log)Even if prevention controls do not exist using record limits; Alert on records pulled by source or app that exceed threshold <br> Threshold per single session; Threshold per aggregate sessions within a time frame; Potentially threshold alert per all sources per time frame | 4.48 |
| Other Database Security Strategies | <br> - Conduct database-centric vulnerability scans with database authentication<br> - Specialized database security audit and assessment tools (i.e., Trustwaves AppDetectivePRO)1provide a more focused analysis<br> - Microsoft baseline security analyzer (MBSA)2can also perform checks on SQL server<br> - The Center for Internet security (CIS) benchmarks3provide hardening guidance up to SQL Server 2022<br> - Dont stop with baselines and compliance. Conduct robust penetration testing on all of the attack surface. | 4.49 | 
| Data Encryption | Data at rest is still at risk of being stolen.; USB drives, swappable drives, laptops, mobile devices; Portable media and devices are high risk. Accidental loss still constitutes a data breach.; **Ponemon** estimates average cost per record $146; In 2023, the average cost of a data breach in the United States amounted to 9.48 million U.S. dollars, up from 9.44 million U.S. dollars in the previous year. <br> Encryption at rest protects data from disclosure; Significantly decreases costs and risk of data breach; Implementation varies based on what is being encrypted. | 4.52 |
| Encrypted Data | Assume stolen data or accidental loss of media; Encryption makes data unreadable. Now assume hacker gains remote access to server; Data is encrypted and mounted for user access.; Does the hacker have access to the data? YES; Is the data cleartext or encrypted? CleartextMost encryption solutions do not protect mounted data.;  Includes plugged-in USB drives and disk/database encryption | 4.53 |
| Encrypted File System (EFS) | EFS can be used to encrypt a user's files or folders.<br> Contents encrypted with symmetric key<br> Symmetric key protected by asymmetric keyDefault asymmetric key is protected by user password<br> User key or recovery agent needed to access data<br> Local administrator is default recovery agent<br> Local PKI will be used over self-signed certificate<br>  Allows multiple key recovery agents to be issued | 4.55 |
| Full Disk Encryption (FDE) | Instead of encryption files, folders, and databases, why not just encrypt everything?; Multiple hardware/software solutions; Performance impact <10% and usually < 5%; Mandated by most cyber insurance and compliance standards; Depending on solution, disk encryption requires user interaction.; User PIN or password common; USB key can act as unlock key; Trusted Platform Manager (TPM) may allow automatic boot.  **FDE Can Protect against BootKit Attacks** | 4.56 |
| Kon-Boot | is a hacking tool used by booting to a USB or CD.; System boots to Kon-Boot, which hooks BIOS; Then Kon-Boot modifies Windows kernel in memory.; Works on all versions of Windows from XP to Windows 11, and Mac OS; Now authentication verification is bypassed. Can log in to any local or domain cached account; Or can log in to local administrator; *All without modifying end system.* **Prevent with FDE or locking down BIOS** | 4.57 | 
| VeraCrypt | VeraCrypt1is an open-source disk encryption solution. Supports full disk encryption with passwords or key files Supports dual boot operating system deployments Allows creation of hidden operating systems Works on Windows, Linux, Unix, and MacCan also create encrypted containers Container is an encrypted file mounted as a drive Intent is to dismount drive when not in use | 4.58 |
| BitLocker | Windows 11 Pro, Enterprise and Education include BitLocker.; Applies to Windows 10 as well.BitLocker supports full disk AES-256 encryption; Can encrypt USB drives (BitLocker To Go); Supports password and smart card unlock as well as auto unlockEncrypting disk generates 48-character emergency recovery keys; Keys can be backed up to Active Directory or Entra ID.; Supports scripting and native to asset management platformsRequires Trusted Platform Module for automatic boot handling | 4.59 |
| Trusted Platform Module (TPM) | TPM is like a smart card built into a motherboard.; Requires TPM on motherboard; Optional add-on to many desktops; Built into business laptops except for MacsTPM protects volume master key (which unlocks symmetric key); Supports multifactor authentication (PIN and/or USB drive key); But then cannot support automatic bootingAutomatic boot is far more secure than without disk encryption; Attacker must attack login form or use physical device attacks | 4.6O |
| BitLocker Network Unlock | Server 2019/Windows 10 and later support network unlock.; Allows TPM + PIN without user intervention; Requires UEFI firmware and proper DHCP settings; Also requires Windows Deployment Services (WDS)WDS uses asymmetric keys to secure DHCP communication.; Public key distributed to network unlock clients; Public key of WDS encrypts second copy BitLocker volume key; Client encrypts this with WDS public keyB |  4.62 | 
| Data governance | greatly impacted by:; File classification; Data loss prevention; Information policy enforcement | 4.66 |
| Acceptance | First task is to identify key data and where it is expected; File servers; Database servers; USB drivesNext is to realize where it may end up; Laptops; Mobile phones; Cloud storage | 4.67 |
| File Classification | To control and audit sensitive files requires classification.D:\pci_share\530_backup.xlsx <- Contains PCIMaybe files in pci_share are expected to have PCI data; File server is properly segmented and intended for PCI....Yet user with read access can copy it to local boxAssume you saw a file called 530_backup.xlsx on a desktop.; Would you assume it had credit card data?; File classification adds tags to identify and control files. | 4.68 | 
| Win File Classification Infr | Server 2008 R2 and later support file classification;     Requires File Server Resource Manager (FSRM) roleAllows assigning properties to files;     Properties can be anything.; Clearance required; Level of PII - Whether something is PCI or EPHI; Date something occurred; Impact of disclosure | 4.69 |
| File Properties | 2008 R2 only supports local file properties.;    After 2008 R2, properties can be local or in AD.Properties added in Active Directory Administrative Center;    Dynamic Access Control -> Resource Properties;    Includes many file properties that can be enabledPowerShell can export andimport properties and settings. | 4.7O | 
| Alternate Data Streams (ADS) | File classifications are stored in alternate data streams. Feature of NTFS that allows data to be attached to existing data; <br> get-content -path C:\test\sec530.txt -Stream "FSRM{ef88c031-5950-4164-ab92-eec5f16005a5}" | 4.71 | 
| Automatic Classification Rules | Multiple methods to set properties on files; **Manual**: User sets properties on one or more files at a time; <br> **Location-based**: Automatically sets properties if file exists in a folder (folder classifier); **Content-based:** Automatically set properties based on content or regex pattern within file (content classifier)Automatic classification can run in *continuous mode or on schedule.*; Continuous mode is not real-time but fairly quick. Regex and basic pattern matching are used to set classification rules. | 4.72 | 
| Optical Character Recognition (OCR)  Integration | File classification supports OCR of TIFF (faxes and scans).; Vendor solutions have more file support and OCR capabilities.Possible to live off the land with  PowerShell; Find certain files such as JPG; OCR scan them looking for sensitive data; If sensitive content found, add file property; Can be integrated into automatic classification | 4.73 | 
| Moving Files |  File classification was designed for Windows file servers.; What happens when the file gets moved?; Copy to NTFS drive keeps properties but may not use them; Copy to other file systems such as FAT32 and properties are lostSharePoint and Office 365 integrate with FCI.; Restrictions can be applied to documents using properties.; Commercial DLP solutions replace or integrate with FCI.May be necessary for classification with certain file types or applications | 4.75 | 
| Purview Information Protection (formerly Azure Information Protection) | Microsoft FCI is out of support now, but Office 365 and SharePoint Online can still integrate with it. Microsoft has replaced it with Purview Information Protection (formerly AIP).; Similar to AD Rights Management Services (RMS) (on premise); Neither Purview nor AD RMS are free. -But it may be part of your subscriptions.Purview can also classify and label data like FCI (and much more); But properties and content are handled completely different.M | 4.76 |
| Microsoft Purview | Alternate data streams can be removed with ease.; To secure data and file properties, Purview may use encryption.; Each document is encrypted with a new AES key.; Key and file properties and restrictions are encrypted with the organization's public key.; Users private key used to sign document | 4.77 | 
| Classify and Protect Example | PS C:\> Get-Content -Path C:\test.txt <br> ABCDPS <br>  C:\Users\ivalenzuela\Downloads> Get-Content -Path C:\test.ptxtThis file uses Microsoft Information Protection solutions. Open it using an application that supports protected files.  You can download Microsoft's protected file viewer from: http://go.microsoft.com/fwlink/?LinkId=280381 Learn more about Information Protection solutions at http://www.microsoft.com/rmsDo not change this file in any way -- doing so will result in data loss.....<rest ommitted> | 4.78 |
| Sensitivity Labels |  Sensitivity labels can be applied manually (requires E3), or automatically based on policy and regular expressions (requires E5)....These labels are supported across Microsoft 365, Sharepoint, OneDrive... | 4.79 | 
| Microsoft Purview Information Protection Scanner | Information Protection can scan and label files across on-premises file servers, Azure, S3 buckets, and SQL databases. | 4.8O | 
| Sensitive Information Types / SITs | SITs are used to detect sensitive information in an organizations documents, files, emails, chats, etc. Policies can be created to take an action if the SIT gets a match. For example: <br> Could tag an Excel Workbook with the sensitivity label Highly Confidential <br> Warn a user that they may be trying to share something inappropriately <br> Block a user from sharing a document containing something sensitive <br> Could prevent the sensitive information from being displayed in a Teams chat <br> Be set up to perform a regulatory compliance scan to safeguard against potential insider trading | 4.81 |
| Data Loss Prevention (DLP) | Data loss prevention focuses on protecting data from unauthorized access or placement.Combination of content inspection and file context, such as file classifications <br> **Network:** Detects and blocks network use of data <br> **Data at res:** Discovers and deals with unauthorized data placement <br> **Endpoin:** Detects and blocks endpoint use of dataPrevention in  | 4.87 | DLP ignores emphasis on detection | 4.87 | 
| Network-Based DLP | Network systems capable of performing content inspection; Next-generation firewalls; Secure web gateways ; Secure email gateway; Intrusion detection system; ICAP integration can integrate vendor DLP solutions;  Example: NGFW and web proxy likely support ICAP; Be careful of encryption blindness.; Web application firewalls; Database firewalls; Network security monitors | 4.88 | 
| DLP with IDS | IDS/IPS rules can look for specific content <br> *'alert tcp any any -> any any (pcre:"/4\d{3}(\s|-)?\d{4}(\s|-)?\d{4}(\s|-)?\d{4}/"; msg:"DLP PCI Visa number in clear text"; sid:1053000; rev:1;)'* <br> IDS usually includes sensitive data preprocessors.; Native capabilities to detect credit card numbers or other sensitive data such as social security numbers; Can be configured to only monitor certain hosts or networks; Can mask sensitive data in alert data and packet captures | 4.89 | 
| Network DLP Limitations | Network DLP protects against basic data leakage. <br> Attacker capable of easily bypassing network DLP <br> Content inspection depends upon cleartext visibility. <br> - Network encryption without TLS Inspection = FAIL <br> - Encrypted file over cleartext network  protocol= FAIL <br> - Basic encoding such as base64 = LIKELY FAIL <br> - Application-level compression = LIKELY FAIL; Does not mean network DLP is useless (defense-in-depth) | 4.91 | 
| DLP, CLoud | Apps may have DLP built in, Sharepoing O365, ect. | 4.92 |
| File Relocation, DLP | Files end up in unauthorized locations.; Scripts can be scheduled to find and handle exceptions.; DLP agents do the same with centralized management. <br> Exception handling: Move file to authorized locationReplace the previous location with shortcut or text file to new location Notify user of policy violation and request cleanup <br> Ability to report on policy violations is underrated | 4.93 | 
| DLP Agents | Agents provide a lot of capabilities for protecting data. <br> Automatic file classification and recommendations <br> Provide on-screen notifications and policy violations <br> Can require user to provide reason for odd behaviorRequires agent deployed and running on all systems <br> Agent capabilities provide data policy enforcement. | 4.94 |
| DLP Agent Bypass | Administrator access can disable, uninstall, or bypass agent;     Motivated adversary will be capable of bypassing agent; Content can be written with encryption or encoding.; Partial data reads and writes can evade DLP monitoring.; Shadow copiesDefense with DLP is still significantly improved.;     Why is service not running or agent uninstalled?;     Why did multiple sensitive files just have policy violations? | 4.95 |
| Data policies | control who, when, and where data is used.; Should include how data MUST be protectedEnterprise data control requires a combination of:; Proper file classification; Data loss prevention capabilities; Ability to implement and enforce data policies; Knowing thyself | 4.99 |
| Access-Denied Assistance | Example of a simple data control is notifying users of violations; Windows has built-in access-denied assistance; Visually notifies user of policy violation; Configured via Group Policy Object (GPO) and PowerShell | 4.10O | 
| Dynamic Access Control (DAC) | Simple access control lists are insufficient.; Group membership is hard to control and inflexible.; Other details need to factor into access.; What device is being used?; Who is accessing device, and what attributes do they have?; How does this apply to file classifications?Access controls need to be calculated on-the-fly; In the past Microsoft used Dynamic Access Control; Microsoft removed DAC from Windows Server 2022 and Windows 11 and recommends moving to Role-Based Access Control (RBAC) | 4.101 | 
| Entra ID and RBAC - A Primary Source of  Truth | Entra ID utilizes role-based access control (RBAC) to authorize entities based on roles. It uses three elements to do so: <br> 1.  Security principal: an identity that gets thepermissions. Could be a user, a group, aservice principal or a managed identity.<br> 2. The role: specifies the permissions that thesecurity principal has. <br> 3. Scope: a scope defines the set of MicrosoftEntra resources the role member has accessto. The most common scope is organization-wide (org-wide) scope. | 4.102 | 
| Entra ID and RBAC,  Conditional Access | Entra ID and RBAC allow some unique features including:    <br> Dynamic membership rules for groups <br> Just in-time access through the Privileged Identity Management serviceThis can put you on the road to implement conditional access policies.     <br> For example, when a user attempts to access applications, conditional access policies can ensure a user has seen and agreed to the terms of use prior to being able to access an application. | 4.103 |
| Time Restrictions | Employee access should be limited to working hours. <br> Limits malware capabilities <br> Can aid in detectionWhy is user1 attempting login at 8:00 PMwhen he or she never works after hours?Computer Configuration -> WindowsSettings -> Security Settings -> LocalPolicies)  -> Security Options <br> Network security: Force logoff whenlogon hours expire (recommended) | 4.104 |
| Cloud Time Restrictions | Many cloud-based systems focus on always available data.; Creates labor law issues; Does not follow concept of least privilegeExample: Office 365 and SharePoint Online; Requires  on-premise AD synchronization to limit login times; ZTNA solutions can add restrictions too; Alternative solution is scheduled PowerShell scripts; Enable and disable user access with automated logic | 4.105 |
| Data Access over the Network | Internal NGFWs can help enforce data access.; Enforce time constraints; Enforce network-based DLP; Applied on a per user, per device basis; Control data movement by source and destination | 4.106 | 
| Removable Media | Data copied to removable media poses a massive risk. <br> DLP solutions support lockdown of external hardware. <br> Includes storage and other devices like webcamsAble to block unauthorized and unencrypted portable storage by default <br> Using BitLocker To Go and the below GPO settingDeny write access to removable drives not protected by BitLocker. Can be set to only allow BitLocker drives from specific organizations | 4.107 |
| Data Protection Policies | Multiple technologies available to apply policies to data; <br> RMS and Information Protection help with discovery,classification and protection.; <br> Start migrating from DAC to RBAC.; <br> Group policy can enforce certain settings.Third-party solutions may provide a more holistic approach.; <br>  Such as Mobile Device Management | 4.108 |  
| Data policies | need to enforce and audit the who, what, when, where, and how data is accessed. Answering these questions is difficult and requires multiple solutions. Data policies also should dictate how data is handled when stored, such as does it require encryption? | 4.109 |
| Bring Your Own Device (BYOD) | Industry push for bring your own device; Potential for significant organizational cost savingsAs security specialists, your response can be:1."Are you freaking crazy?"2."Let me look into this. I needto see how we can secure devices we do not own."Internal voice: "Is this possible?" | 4.111 |
| Centralized Approach BYOD (unmanaged) | can never be considered trusted. Data never leaves corporate data center.Data is accessed using corporate controlled access methods. | 4.112 |
| BYOD Centralized Security Approach | Data should only be accessed by corporate resources. <br> Untrusted device should never be able to pull dataRequires changing default settings <br> Disable drive mapping  | 4.113 | <br> Enforce multifactor authentication; Strongly recommend not using SMS or callback <br> Disable clipboard or limit to only remote system | 4.113 | 
| Trusting the Untrusted | BYOD does not have enforced local security.; Is system patched and with antivirus?; Is system rooted or are untrusted applications installed? Mobile malware undermines security with: **Keyloggers**, Username/passwords and data stolen by: <br> **keystrokeScreen scraping**: Recording screen or taking screenshots <br>**TLS Spoofing**: Install evil CA certificate and monitoring traffic; Certificate pinning helps but adds its own risks. | 4.114 |
| Mobile Device Management (MDM) | Device providers such as Android and IOS provide mobile device management (MDM) APIs.; Some standalone capabilities; Primarily designed for third-party use.  Abstracts corporate resources from personal use and access; Uses either corporate workspace approach; Or application containerization <br> MDM solutions work by allowing either complete or partial control of devices. This control allows the establishment of security standards in order to access corporate resources.| 4.115 |
| Application Container | Instead of workspaces, MDM solutions can also apply policies per application.; Provides a seamless user experience; Uses built-in device APIs <br> Per application policy enforcement allows for: Additional authentication requirements to run protected apps; Per application encryption; Control device capabilities while inside apps or from app to app | 4.117 | 
| Intune MAM vs. MDM | Intune App Protection Policies for BYOD. This helps protect corporate data on unmanaged devices by allowing for a bring-your-own (BYO) scenario. <br> Implement MDM through device enrollment. Device enrollment secures the device so that it aligns with the organization's policies. Intune deploys and enforces policies through a management profile, which is installed on the device during the enrollment process. | 4.118 | 
| MDM Example | example on slide | 4.12O | 
| Conditional Access + Intune | Conditional Access works with Intune to enforce policies based on device risk.  This can be calculated based on signals  like user, location, device and application details or real-time risk score. | 4.121 | 
| BYOD MDM solutions | make a bad situation better.... Policy enforcement can require password/PIN requirements.... Force app scanning and antivirusMDM security fails in comparison to traditional system... MDM device visibility and logging not even close to traditional Windows/Mac/Linux desktop/laptop... Prevention technologies not as mature... Use of personal and corporate fails secure workstation model | 4.122 |
| Private Cloud | Organizations likely using private cloud in data centers;   Cloud = Cool sounding word that means nothing;   Mostly used to describe virtualization platformsHypervisor abstracts hardware and shares among virtual operating systems | 4.126 |
| Hypervisor Networking | Networking breaks down into high-level functions: ; Virtual machine networking ; Storage network ; Migration network ; Management network.......Network segmentation not required but highly recommended ; Segmentation can be physical or VLANs | 4.127 |
| Network Storage | SAN and NAS require network access. <br> Option #1 VLANs <br> Option #2 Dedicated networkUnauthorized access to storage = FAIL <br> Able to access all virtual hard drivesHypervisor full disk encryption = no protection <br> Difficult to audit or see unauthorized activityDedicated network recommended <br> Requires dedicated switches and physical NICs | 4.128 |
| Hypervisor Migration | Hypervisors are capable of migrating live virtual machines (VM) from one hypervisor to another.;     Includes memory and network connections; Changes registration for VM on completion;     Traffic is cleartext; Encrypted migration available in vSphere 6.5 and later1; Adds CPU overhead (approximately 1 core per 10 Gb traffic)Separate physical NICs ideal or dedicated VLAN | 4.129 |
| Virtual Switch Security | Common virtual switch security capabilities include:<br> **Reject MAC address changes**:  Rejects traffic from any MAC address not issued by hypervisor;  Required for virtual clusters or load balancing; <br> **Reject forged transmits** : Verifies source MAC to VM;  <br> **Traffic mirroring support**: Controls VM support of promiscuous mode or mirroringImplementation varies by hypervisor | 4.13O | 
| VM to VM Traffic| VM to VM traffic must leave virtual switch if: VMs are on different hosts; VMs are on different VLANs or across a gateway deviceMethods to see VM to VM traffic include:; Deploying sensors/network capture device to every host; Configuring policies to keep VMs on separate hosts; Implementing virtual switch port mirroring; Purchasing virtual tap software | 4.132 | 
| Hypervisor Security | Gaining admin access to a hypervisor grants full access.; Management network access needs to be protected.;  Use hypervisor firewall and authentication restrictions;  And network-based firewalls <br> Forms of hypervisor compromise:; **Weak passwords; Service exploitation; VM escape** | 4.133 | 
| VM Escape | Regardless of vendor claims, VM escape is real. <br> VMware (ESXi,Workstation/Fusion) = CVE-2022-317051 <br> Microsofts Hyper-v CVE-2021-284762<br> Xen 4.6 and earlier CVE-2017-89053Some exploits use RPC calls from guest tools.<br> Guest tools are not required.Some exploits attack flaws in virtual drivers or memory handling.<br> Fix is to establish a routine for continuous patching | 4.134 | 
| Physical Separation | Separate hypervisor deployments should be considered based on:; - Data sensitivity; - Compliance requirements; - Risk of VM compromiseSeparation includes:; - Different root passwords; - Different cluster membership; - Potentially different management server for high-risk shops | 4.135 | 
| Lockdown Mode | VMware lockdown mode prevents root-level remote access.; Only allows vCenter to maintain root-level remote access....The same concept can be achieved with other platforms; Remote administration actions should come from management server; Exception is during network issues or troubleshootingConsole access always has full administrative rights;  Hypervisors usually have remote out-of-band management.L | 4.136 |
| Harden Hypervisor | Standard system hardening should be followed: **SSH**: Limit access, implement lockdown mode <br> **SNMP**: Disable if not in use <br> **TLS**: Enforce newer versions of TLS <br> **Remote** logging : Send logs to remote logging solution <br> **Passwords**: Use strong passwords <br> **Certificates**: Replace self-signed certificatesMultiple hardening guides available online | 4.137 |
| Central Management Lockdown | Management platforms support multiple APIs and services. - Higher likelihood of exploitation - Lockdown services to service use <br> Segmentation with firewalls is necessary but difficult. - By design, more users access management servers. - User access needs to be strictly controlled. <br> TLS communication should not be self-signed. - Web services could benefit from WAF protection. | 4.138 | 
| VM Interaction | The below abilities need to be carefully limited:; Copy and paste - Possible use of data exfiltration; Clone - Allows creating offline copy of systems; DVD/USB  - Autorun attacks or mounting malware; Snapshots - Denial of service to storage space; View console - Gaining local administrator accessWhen in doubt, think evil; None of the above seem inherently evil | 4.14O |
| Virtual Machine Tools | Installing guest virtual machine tools recommended by vendor; Provides virtualization optimized drivers<br> -Reduces memory consumption<br> -Improves disk and CPU performance<br> -Supports system quiescing for snapshots and backups<br> -Supports automatic restarts and clean shutdowns; Provides host to VM capabilities such as copy and paste<br> -Individual settings can be disabled on host or inside VMsAre risks of additional drivers and capabilities worth added risks? | 4.141 |
| Hypervisor-Based Endpoint Protection | Security vendors offer hypervisor integrated solutions. - Example: VMware Endpoint Security and third-party vendor <br> Endpoint security solution installed as virtual machine - Hooks into hypervisor and performs file, memory, and processscanning - Offloads performance from VMs (protects against AV storms) - No need for agents within virtual machines (except guest drivers)Capabilities fail in comparison to agent within VMs. - Ask the vendor which is more secure and verify with testing. | 4.142 | 
| Hypervisor Additional Threat Mitigation Guidance | Following the report published by Mandiant1on the usage of malicious vSphere Installation Bundles to install backdoors across ESXi servers, <br> VMware recommended: -Enable secure boot; -Enable VMkernel network adapters on the isolated management network only; -Decoupling ESXi and vCenter Servers from Active Directory and use vCenter Single Sign-On; -Enforce multi-factor authentication (MFA) for all management access to vCenter Server instances and store all administrative credentials in a Privileged Access Management (PAM) system; -Implement lockdown mode; -Implement centralized log management (via SIEM) | 4.143 |
| Docker | Docker uses the capabilities of the host OS kernel (Linux or Windows) to run an application in what is called a container. <br> Abstracts software to run on minimal operating system <br> Like a virtual machine but without all the overhead <br> Consumes less CPU, memory, and disk <br> Large deployments need basic scripting or orchestration tools.Docker1is one of the more common container solutions. <br> Common for microservice deployments <br> Works in private and public clouds | 4.147 |
| Virtualization vs. Containerization | With containerization, functionality of the host system kernel is used to isolate multiple independent instances (containers). By sharing the host kernel and operating system, containers avoid the overhead of virtualization. This is why containers are considered a more lightweight solution1Uses host OS kernel capabilities to contain processes..... Example: Namespaces, SELinux, control groups, and chroot | 4.148 |
| Container Impact | **PROs**:  -Quickly add/remove nodes; -Uses less CPU, memory, andhard drive space; -Simplifies patchingBoth software and OS; -Can be more secure; -Isolation of applications <br> **CONs:** -Significantly more complex; -Requires staff training; -Security relies on OS kernel; -Requires Linux *; -Overkill for smalldeployments | 4.15O |
| Protecting Against Container Escape | Run containers as standard Linux users. -u flag can force the container to run as a specific user. <br> Run services in containers as standard Linux users.<br> Example: *RUN useradd -ms /bin/bash service_account USER service_account* <br> REmove SUID and SGID use in container images. Simple adjustment to Dockerfile or image build: *RUN for i in `find / -perm +6000 -type f`; do chmod a-s $i; done* | 4.152 |
| Control Groups (CGroups) | Containers can consume entire host resources; Makes them vulnerable to denial of service. **Possible to limit resources on a per container basis**:  <br> *docker run -m 512m --memory-swap 1g* <br> *docker run -m 512m --memory-swap 512m* <br> *docker run --cpus="1.5"* <br> *docker run --storage-opt size=100G* <br> *docker run --ulimit nofile=10000:10000* | 4.153 |
| Malicious Images | Docker containers deploy from an image; Most images come from Docker Hub.; Docker Hub is free and allows community images.Images can contain malicious content, so trust is an issue.;  Use Docker Content Trust (defaults to on for Docker 1.9+): *export DOCKER_CONTENT_TRUST=1;* Only allows signed docker containers to run; Alternative to signing is using Automated Build images; | 4.154 |
| Secrets | Secrets, Passwords, encryption keys, and other sensitive data may be necessary for a container.; Containers often span multiple hosts.; Secure transmission and storage is necessary. Docker swarm, Docker compose, and Kubernetes support secrets.   Sensitive data is stored by management service; Data is encrypted during transit to container and at rest | 4.155 |
| Container Auditing and Logging | Containers are short-lived, making auditing more important. **docker diff** shows container changes from its image. <br> Log collection requires mounting folder to container...*docker run -v /logs/nginx1:/var/log/nginx/ nginx*. Syslog or collection agent on host can ship off logs....**docker commit** can make a snapshot for incident response. | 4.156 |