| book | slide | page | 
| -----|-------|------|
| Perimeter Security and the Need for Zero Trust | Perimeter security has a major failing: it was not built with assume breach in mind, yet a compromise is inevitable. Inside access is not always benign. Modern attacks are inside out. A trusted system brings attacker in. Internal access is loosely regulated. Assets wont be 100% controlled. | 5.3 |
| Zero Trust Architecture | developed by Forrester's John Kindervag in 2010; **Data-centric focus** <br> **Basic principles of zero trust:**; Network is always hostile: assume breach; Internal and external threats are always present.; Internal network does not equal trusted; Every device, user, and network flow must be proven.; Log and inspect all traffic. | 5.4 | 
| Zero Trust over Time | The original ZT concept has been evolving over time; Network or identity? **Both!**; Implementing ZT principles is difficult; Beware of taking shortcuts and opening more security gaps; Balance, based on risk prioritization, is needed | 5.5 |
| Zero Trust Tenets | **1. Network is hostile**<br> -Traffic must be authenticated.<br> -Traffic must be encrypted.  <br> **2. Least privilege must be enforced**.<br> -Trust must be factored into least privilege.<br> -Trust is no longer binary (yes or no).<br> -Access is granted per-session basis based by dynamic policy. <br> **3.** All data flows must be known and controlled. <br> **4.** All assets must be scanned, hardened, and rotated.   <br> **Trust Nothing Verify Everything** | 5.6 |
| Identity = User + Device + Context | Forresters original ZT research used the concept of a network agent for access.  In that model a network agent is a user and device combined.This new type of identity (user+device+context) is used to determine authorization. <br><br> User + corporate laptop = what access?<br> >User + personal laptop = what access?<br> User + corporate phone = what access? <br> Access to data is based on variable or dynamic trust | 5.7 |
| Variable Trust | Access controlled by variable trust; Similar to real-life credit scores.  Attempt to access PCI database requires +40 points:  <br> User authenticated with username/password +10 points <br> Device authenticated +10 points <br> Known device and location +10 points <br> Multifactor authentication with smart card +20 points | 5.8 |
| Trust over Time | Risk to systems increases over time. <br> - Systems need to be reloaded: Due to deviations from baseline <br> - Credentials need to be rotated.: Limits compromise and reuse <br> - Certificates need to be replaced.: Limits compromise and reuse <br> - Cycling time increases with security. But still should take place | 5.9 |
| Example of Zero Trust Scenario **Remote Exploitation or Insider Threat** In this example, a malicious cyber actor compromises a users device through an internet-based mobile code exploit. While a level of compromise occurs, damage is limited, and the time for defensive systems to detect and initiate appropriate mitigating responses is greatly reduced. | 5.1O |
| NIST: ZTA Reference Architecture  | (December 2022) NIST SP 1800-35B: Implementing a Zero Trust Architecture, builds up on NIST SP 800-207. This NIST Cybersecurity Practice Guide explains how 65 commercially available technologies can be integrated and used to build various ZTAs (see notes). TL/DR: no solution can provide full 100% ZT! | 5.11 |
| Federal Zero Trust Strategy | OMB has shared some of their priorities in a public document that details their journey: - Removing implicit trust of connections between systems, starting with HTTP and DNS - Deprecate decryption in transit with long-lived keys to favor context-aware decisions about visibility vs attack surface - Shifting away from traditional intranet/VPN model - Moving authentication to the application layer and use of phishing-resistant authentication methods - Treating everything as internet-accessible - Big emphasis on first/third-party testing (see new SEC568: Combating Supply Chain Attacks with Product Security Testing) | 5.15 |
| What Good Looks Like |  ZT will be infused throughout the organization;  ZT is not just about infrastructure, its also about mature security operations and high-quality, timely and relevant detection content (notice threat intel) | 5.16 |
| Implementing and Auditing Zero Trust Strategies | Mapping to NIST SP 800-207 and CIS Critical Security Controls V8 (or equivalent in other geographies)     Security architects can implement the tenets of ZTA using existing control frameworks, aligning with: NISTCyberSecurity Framework (CSF)and following the NISTRisk Management Framework (RMF).  The CSF provides the controls objectives and the RMF provides a high-level process for planning and implementation. The ZTA tenets can be supported by specific CSC control activities. Controls v8 supports a zero-trust architecture. This can be a great starting point to prioritize your journey. | 5.17 |
| Identity as a Perimeter | Probably one of the most important transformations for any organization that wants to implement ZT.  <br> - It requires a short and long-term approach to managing: Identity, Authentication, Authorization:  Across people, devices, networks, workloads and data. <br> Identity/Authentication/Authorization: People, Devices, Networks, Workloads, Data | 5.2O | 
| Identity Management | Ensuring that data is accessed by the right users, at the right time and for the right purposes often requires consolidating using centrally managed identity systems.<br> For most of us, the starting point is an on-prem Windows Server AD replicating with Entra ID.  |  5.21 | 
| Identity Federation |  Next logical step could be to use app provisioning in Entra ID. <br> - Allows users to access resources across multiple domains or organizations with a single set of credentials (e.g., Dropbox, Salesforce, ServiceNow | 5.23 |
| Authentication, SaaS Applications, and Federated SSO |  On-prem AD servers will continue to use windows authentication protocols.<br> For cloud apps, Entra ID will use modern authentication protocols like SAML, OAUTH, OIDC.<br> Add risk-based authentication and conditional access, with passwordless capabilities such as hardware tokens, certificates, or windows hello where possible.  | 5.25 |
| Attack Vector in Azure/Entra ID | Authentication request from on-prem to https://login.microsoftonline.com. The on-prem AD Connect service pushes objects to Azure/Entra ID. <br> 1.Enrollment of a TLS certificate for Microsoft Login domain (no verification)2.Launches a DHCP Rogue, ARP spoofing, or IPv6 RA attac | 5.27-28 |
| Lessons Learned and Mitigations |   On-prem is still in most cases the weakest link. <br> Layered defense is vital, including: - Endpoint security and secure workstations 1, 2 - Network segregation and monitoring - Hardening against L2 attacks (e.g., ARP spoofing, DHCP, IPv6 RA) increases the attackers cost. <br> Privileged Access Management - Implement PAM solutions to enforce secure administrative access to the AD Connect server. - Monitor for abnormal activity. <br> Restrict access to certificate templates that allow server authentication and monitor enrollment. | 5.31 |
| Attackers Always Follow the Path of Least Resistance |   Remember: Attackers are lazy! - You need to continue working on securing your on-prem identity management systems, implementing less implicit trustas these are often the weakest link, and the target of attackers. - This includes: User passwords (yes, we still have those) <br> - Service accounts | 5.32 |
| NIST 800-63B | NIST clearly states password rotation is not recommended. "Verifiers SHOULD NOT require memorized secrets to be changed arbitrarily (e.g., periodically). However, verifiers SHALL force a change if there is evidence of compromise of the authenticator."1 Based on studies that show password rotation increases the likelihood of poor passwords | 5.33 |
| Password Policies | Rotation increases chance of users picking weak passwords. - Primarily due to lack of password policy controlsWindows supports fine-grained password policies. - Allows different password policies per user or group | 5.34 |
| Third-Party Password Policy Management | Microsoft's password policy allows weak passwords.Â• Winter2023! is susceptible to cracking and guessin; But meets complexity requirements <br> Third-party solutions provide granular policy requirements; Cannot contain dictionary term; Disallow characters at beginning or end of passwor; Present GUI breakdown of rule; Disallow passwords using common permutationsLinux pluggable authentication module (PAM) has granular support | 5.35 |
| Entra Password Protection | Global and custom banned password - Works across Entra ID users and can sync-up policies with on-prem AD (see notes) | 5.36 |
| Password Auditing | Passwords should be evaluated for weaknesses. <br> - Consider doing it before the adversary does.Possible to intentionally dump hashes and test them <br> - Get-bADpasswords can automate the process <br> - Hashes can be pulled from volume shadow copy <br> - Linux hashes in /etc/passwd and /etc/shadow <br> Hashes can be sent to system with GPUs: - Low-cost solution for password auditing | 5.37 |
| Automatic Credential Rotation | Some accounts are high risk and need rotation frequently; Local administrator accounts (if enabled); Service accounts...Both account types are attacker favorites.; Gold images leave local admin password the same; Service accounts often set and never touched again;  Service accounts often have admin privileges.Both account types can integrate with automatic rotation. | 5.38 |
| Local Administrator Password Solution (LAPS ) |  is a free tool capability from Microsoft. <br> - Newer version is now built into Windows since April 2023 <br> - Automatically rotates local admin password <br> - Can back up passwords to Entra ID Active Directory, encrypt passwords in AD and store password history in case you need to log back into restored backup imagesLAPS is centrally controlled via Active Directory but can also now be managed via a Configuration Service Provider (CSP) to administer Entra ID policies, and via Intune. | 5.39 |
| Group-Managed Service Accounts (gMSA)| MSAs have some significant limitations.; Only work on one system (cannot be shared); Do not support scheduled tasks; Not supported by older SQL, Exchange, and other softwaregMSA solves many of these issues.; Requires AD schema of Server 2012 or later; Allows service account to work on multiple systems; Works with service accounts and other mainstream services | 5.41 |
| Securing Traffic, ZT | If the network is not trusted, all network traffic MUST be:; **Authenticate**: Prove user/device is legitimate; <br> **Encrypted**: Cryptographically prove source and destination while protecting confidentiality <br> Encryption cannot be perimeter-based.; Requires encryption at either device or application; Endpoints configured to drop anything not encrypted | 5.44 |
| Methods of Securing Transmission | Multiple methods to secure network transmission: <br> - TLS: Transport layer security<br> - IPsec: Kernel-level authentication and encryption<br> - 802.1X: Port-based network access control<br> - Single packet authorization (SPA) <br> **TLS and IPsec provide authentication and encryption.**:- 802.1X and SPA only provide authentication. - Zero trust mandates end-to-end encryption. | 5.45 | 
| Trust Model Change | Computer authentication is often one way. <br> Example: SSL/TLSClient connects to TLS site and authenticates server <br> Client is commonly not verified <br> Yet SSL/TLS supports mutual authentication. | 5.46 |
| Mutual TLS (mTLS) | 1. Client hello  2. Server hello  3. Verify server's certificate  4. Client key exchange with client certificate  5. Verify client certificate  6. Client finished  7. Server finished | 5.47 |
| Client Certificates | Enabling mutual authentication requires simple change.; May just require clicking a radio button; Or adding some text to a configuration file; Requires clients to have certificates and a CA | 5.48 |
| mTLS for API Security |  mTLS is often used in business-to-business (B2B) applications and microservices to authenticate access to APIs.; Combined with API gateways and mTLS cert offloading, it can add an authentication layer to serverless and modern API based apps.; Mutual TLS authentications main downside is the difficulty in managing the certificate lifecycle. | 5.49 |
| Public Key Infrastructure (PKI) | Automation is critical for supporting zero trust.; Private PKI allows automation of certificate deployment; With support for client and server certificatesWindows Server capable of significant PKI capabilities; Automatic certificate enrollment via GPO and AD; Certificate templates and restrictions; Secure private key archival; Hierarchical certificate authorities roles and services | 5.5O |
| Certificate Authorities (CA) |  PKI is composed of one or more certificate authorities.<br> **Root CA**:  Self-signed CA and most trusted CA<br> **Intermediate CA**:  Down-level CA usually controlling subordinate CAs <br> **Subordinate CA**:  Certificate issuing CA | 5.51 |
| Certificate Authority Types | **Standalone**; Common to small shops; Manual certificate creation; Common for Linux shops; Recommended for root or intermediate CAs; Should be run off-line; Or out-of-band <br> - **Enterprise**; Windows-specific deployment; Requires domain membership; Allows automatic enrollment; Can be used for smart cards; Requires AD access (never offline); Contains templates; Active Directory Certificate Services PKI 2019 can be deployed to Azure, AWS or GCP (see notes) | 5.52 |
| Automatic Enrollment | Windows PKI allows supports of automatic enrollment of:  - Device Certificates, Associated with device activities; <br> - User Certificates: Associated with user activitiesCapabilities and integration:; 802.1X; Code signing; TLS; Smart cards; IPsec; LDAPS; Remote Desktop Protocol; PowerShell remoting | 5.53 |
| IPsec, mutual auth | Most folks think of IPsec as a VPN protocol.; Works with VPNs but can do so much moreIPsec is a network layer protocol.; Works with application regardless of IPsec awareness; Works independently of TCP or UDP; Supports hardware accelerationAllows transparent encryptionand authentication | 5.54 | 
| Windows Domain Isolation | natively supports IPsec for domain isolation; Blocks unauthorized non-domain access; Authenticates all trafficÂ•Mutually authenticated; Optionally encrypts trafficCannot attack the invisible; Mitigates Machine-in-the-Middle; Lowers service exploitation risk | 5.55 |
| Windows IPsec | IPsec integration is part of the Windows Firewall.<br> Change IPsec default options (recommended); Default does not mandate encryption for ESP<br> Requires connection security rules<br> Granular control via firewall rules | 5.56 |
| Authenticating Network Access | Zero trust expects mutual authentication and encryption.; May not be possible or practical....Alternative is to authenticate network access; Achieved with network access control (NAC); Or single packet authorization (SPA)<br> NAC is more common and is often centralized.; Centralization makes for strong detection capabilities.; What and where are unauthorized devices? | 5.58 |
| Single Packet Authorization (SPA) | SPA involves blocking connections by default. -Connecting system must first send authentication packet. -Effectively a next-generation port knocking solution, including in cloud environments; <br> **SPA uses asymmetric encryption and HMAC**. -Packet is non-replayable due to HMAC and random data. -SPA includes request to authorize port or program. | 5.59 |
| Host-Based Firewall Capabilities | Endpoint firewalls include prevention and auditing.; Allow or deny rules based on ports; Rules-based on inbound or outbound traffic; Windows supports rules based on executables and file paths<br> **Example:** powershell.exe denied access outbound, Outbound defaults to allow and inbound to deny <br>- Assumes connections from endpoint are trusted; Inbound access is notoriously changed to open | 5.64 |
| Inbound Access | Organizations should only allow connections to authorized services. <br> - Includes services for workstations and serversLog inspection can provide list of executables and ports <br> - Turn these into granular allow rules <br> - Lockdown to specific hosts or subnets as necessary <br> - Then deny anything elseConsider using executables instead of ports to limit access to authorized executables (allow list approach). <br> - Blocks listening on unauthorized applications like Python | 5.65 |
| Outbound Access | Windows and Linux have thousands of binaries per system.<br> -Yet less than a hundred are likely to reach out.<br> -Only authorized binaries should make connections.<br> -Should limit authorized applications to their expected use cases. <br> **SMB** is necessary but should never happen to internet. <br> **powershell.exe** should be used for scripting but may not need outbound access at all. <br> Limiting CustomApp1 to specific hosts/networks helps prevent it from being used as an attack vector upon compromise.| 5.66 |
| Firewall Logging | Host-based firewalls provide a gold mine of information.; Monitoring provides the capabilities to implement granular rules.; Blocked events point to unauthorized connections. <br> -Logs operationalize endpoints as intrusion detection points.; Provides notification of unauthorized inbound and outbound connections; Allows for early detection and response <br> = Network firewalls can provide high-level central filtering. <br> - Endpoint firewalls provide granular filtering. | 5.67 |
| Microsoft Attack Surface Reduction (ASR) |  Attack Surface Reduction (ASR) is a set of additional protections in Microsoft Defender Antivirus that can be turned on to log or intercept (block) some common attack scenarios.<br> - Such software behaviors are sometimes seen in legitimate applications. <br> - ASR can be bypassed but adds an additional layer of protection. | 5.68 |
| NAC Deployment | 1. Initial Connect, 2. Auth via Radious + Mac or cert, 3 Vlan ENtry, <br> - Unauth vlan Steps 4. DHCP Reques on UnAUth Vlan to Nac <br> 5. DHCP Repsonse NAC=Gatway,NAC=DNS, Optional, Fingerprinting <br> 6. Client gets captive portal | 5.72 |
| Core NAC Capabilities | NAC solutions authenticate devices various ways.; 802.1X Port Authentication (CSC 1.5 + 1.6); MAC Address OUI (organizationally unique identifier); DHCP fingerprint-analyzes DHCP packets of systems <br> - Compliance checks- act as augmentation to authentication; Vulnerability scan; Intrusion detection system (IDS)-caution is necessary; Patching/antivirus/user agents/Etc. | 5.73 |
| MAC authentication | is not authentication.; MAC addresses can be spoofed.; Yet validating a client based on MAC is better than not; Beware the perfect solution fallacy.MAC authentication can be combined with 802.1X.; You likely do not use every OUI.; Some MAC addresses are invalid.;  Mainly from MAC tumbling devices or spoofing | 5.73 |
| DHCP Fingerprinting | DHCP request/response can be fingerprinted;   Uses combination of MAC address and option 55;   Option 55 contains the parameter request list.;   How request is performedcan be fingerprinted; What order are options?; What order are they requested?; What is the MAC address? | 5.75 |
| Fingerbank | is an online DHCP fingerprint database.; Used by opensource NAC PacketFence. Used by commercial NAC solutions as well....Contains thousands of DHCP fingerprints; Supports manual lookups using free API key | 5.76 | 
| NAC inline VS OOB | - Inline **PROs:** Works with any device; Minimal design changes, <br> - Inline **CONs**; Potential failure point; Can slow performance; Requires more hardware;  And high-available server recommended <br> - Out-of-Band **PROs**; Minimal hardware required; Fail open or fail closed; Dynamically change ACLs; Dynamically change VLANs <br> - OOB **CONs**; Requires changes to network infrastructure | 5.78 | 
| Captive Portal | Ideally, device passes initial authentication methods; <br> - Captive portal can handle faileddevices or usersDesign is flexible and dynamic; <br> - Terms and conditions onlyÂ•Gives guest VLAN access; <br> - AD authenticationÂ•Provides limited production accessCaptive portal could be forced even with authentications | 5.79 |
| Quarantine, NAC | Authorization should not be static.; NAC can dynamically control access.Conditions that may affect access; Peer-to-peer use;  Or software installed; Abnormal connections; IDS alerts; Endpoint suite alerts| 5.8O | 
| Windows Intune and NAC | If the device isn't enrolled or is enrolled and not compliant its redirected to Intune for enrollment, or for a device compliance check.Â•Users can be allowed or denied access when trying to access corporate Wi-Fi or VPN resources.  <br> Works with Conditional Access. | 5.81 |
| NAC Example | - Authorized; Windows authenticates using computer certificate; Printer allowed by MAC; Printer allowed by DHCP <br> - Unauthorized; Personal device fails; Misconfigured box fails; Adversary cloning MAC may succeed | 5.83
| Post-Authentication Checks, NAC | Post-authentication checks are key to dynamic access; <br> -These are key in a Zero Trust architectureChecks can be custom or built-in integrations like:; <br> -Vulnerability scan <br> Level of risk could change access; <br> -Alternative authentication checks; <br> - SNMPv3, SMB, WMI, SSH, HTTPS; <br> -Port scanning and fingerprinting; <br> -Custom script Â– Choose your destiny | 5.84 | 
| Electric Fence | Mick Douglas refers to dynamic access as an electric fence.; Behave as normal, and you have full access.; Touch the fence, and a digital shock occurs.<br> - Electric shock results in an automated digital response.; Quality controls (QoS) slows access.; ACLs remove access.; PCAP recording kicks in.; User is notified of digital shock | 5.85 | 
| NAC Problems | Organizations are restricted by time and money. <br> - NAC is time-consuming to set up and can be expensive. <br> - As a result, many organizations do not have NAC.Even if deployed, it is likely not deployed everywhere. <br> - Virtual environment does not support NAC well. <br> - Switches in a data center typically do not need NAC.Other forms of device discovery are necessary. | 5.86 |
| Planes of Authorization | - **Control plane** is core of zero trust; Handles central authentication and global policy; Authorizes requests and authorizes access <br> - **Data plane** handles connections.; Establishes connection mediums; Provides switching and routing; But only if control plane continues to authorize accessIdeally, is one device but for practical reasons is multiple | 5.89 |
| MCAP, Micro Core And Perimeter | creates logical zones of trust and functionality.; Full design should include intra-zone connections.; Heavy allow list approac | 5.9O | 
| Segmentation Gateways Can Be Just NGFWs | Segmentation gateways can use known technologies like NGFW,1just implemented in a different waySecurity hardware today supports core backbone speeds. <br> - NGFWs available with 100 Gb interfaces and well over 100 Gb inspection speeds <br> - SDN or solutions to control switch fabric are maturing. <br> - Reverse proxies and identity management are strong.In many cases, L7 inspection is less important than identity.| 5.92 | 
| MCAP and Network Agent | MCAP and access should be based on network agent; - Developer on corporate desktop has access to source code; - Developer on mobile device does notTrust is calculated by user, device, and other factors | 5.93 |
| Inventory Automation | Key to MCAP grouping is device and user integration; - Users and groups usually sync with Active Directory.; - Device integration requires commercial add-on solutions.; - Or simple scripts that hook REST APIs or SSHNetwork agent needs real-time application of user + device| 5.94 |
| Real-Time Device Inventory| NAC and VPN solutions require authentication before providing network access. <br> - Post-authentication task can feed segmentation gateway;  Such as running script to update address objects <br> - Can be achieved by using centralized logging;  Send logs to security information and event management (SIEM);  Use SIEM to react to NAC or VPN logs in near real time. | 5.95 |
| Centralized Protection, Segmentation Gateway | Internal firewalls provide centralized access controls.. Helps push filtering as close to source as possible. Endpoint firewall is granular but deep within network <br>- Filter on ports and application; Filter on user and device; Filter on time restrictions  | 5.96 |
| Dynamic Authorization | Abnormal conditions should be monitored and reacted to. <br> Temporal: Access outside normal user wind <br> Geographical: Access from different locati <br> Behavioral: Access to resource user does not normally u <br> Frequency: Last access or volume of device/user use; Or number of requests over time <br> -Deviation from norm may dictate additional checks:  Multifactor authentication,  Approval from manager or administrator | 5.97 |
| Dynamic Authorization with Conditional Access and RBAC |  - Dynamic authorization is a ZT capability, requiring various PDPs, and PEPs to be able to apply it across people, devices, networks, workloads and data. <br> - Conditional Access is Microsofts implementation of ZT policy engine, taking signals from various sources into account when enforcing policy decisions. <br> - Goes together with MFA (identity), and SSO (authorization) based on Role-Based Access (RBAC) | 5.98 |
| Segmentation gateway | provides centralized: <br>-Network agent (user + device) access controls <br>-Time constraints and limitations <br>-Data-centric port and application controls <br>-MCAP trust zoningNGFW can be deployed as a segmentation gateway. <br>-Capabilities increasing and hardware cost decreasing <br>-Able to automate via robust API supportThe concept of the segmentation gateway in modern Zero Trust apply to identities, devices, networks, workloads, and data | 5.99 |
| Solid Detection Required | Scripting or commercial solutions update the control plane. <br> - But dynamic access necessitates custom trust levels. <br> - Cannot be done without low false positive detectionLevel of detection maturity and capabilities required <br> - Integration between disparate solutions necessaryExamples: <br> - NSM + Sandbox + Flow Data + NGFW + Scripts <br> - Security information and event management (SIEM) + NAC | 5.101 |
| Security Information and Event Management (SIEM) | What is a SIEM used for?<br> - Centralized log collection<br> - Advanced alerting<br> - Systems automation<br> - Analysis system<br> - Compliance repository<br> - Big data analytics platform<br> - Threat intelligence | 5.102 |
| SIEM Components | A SIEM consists of multiple pieces:; Log collectors (agents, scripts, etc.); Log Aggregator; Log Broker; Storage; Search/Report; Alert Engine | 5.103 |
| Log Inspection, SEIM | All system and network access needs to be verified.; <br> - Ad hoc reporting is inefficient and difficult to do.; <br> - Central log collection and scripting is low cost.; <br> -  But also suffers from major deficiencies<br> - SIEM log collection and analysis is recommended.; <br> - Focus should be on key log sources; <br> - And inspecting them for expected network and system use; <br> - Use log enrichment to enhance analysis. | 5.104 |
| Log Enrichment | slide shows the enrichment of a dns query to google.com.  Adds Query, Subdomain, Parent and registered domain, creation time, tags, geo.as, freq. score, and parent domain length | 5.105 |
| SIEM in the Cloud Era | - Some are exporting data from their traditional (aka. compliance) SIEM to cloud based storage like S3 buckets or data lakes like Databricks.<br> - Data analytics methods and serverless queries like Google Dataproc or AWS Athena can help build detection cases. <br> - May require some expertise and functionality will be reduced compared to full blown SIEM, but it can help in threat hunting, building dashboards and other anomaly detection engineering efforts. | 5.106 |
| Log Collection | Logs must be collected prior to inspection.Typically done with:; Log agent-Â– Requires software; Agentless- Requires credentials and scanning of remote systemsNetwork devices often use syslog (NGFW, Proxy, DLP) <br> Other metods exist, such as SNMP traps or APIs.| 5.11O |
| Syslog | Syslog is the most common network protocol for sending logs on the network. <br> - Also, a built-in daemon for network devices and UnixDefault is UDP on port 514 <br> - Some systems support TCP but uncommonRFCs support TLS encryption.1 <br> - Yet most systems only support syslog over UDP without encryption. | 5.111 |
| Syslog Devices | Routers ; Switches ; Firewalls ; Intrusion detection systems ; Application proxies ; Wireless access points ; Printers ; Storage devices (SAN/NAS) ; Hypervisors (ESXi/Xen) ; Unix/Linux ; Data loss prevention ; Behavior analytics solutions ; Mac ; Windows* Â– requires third-party agentThe list goes on and on... | 5.112| 
| Syslog Message Limitations| Inconsistent; Message formats can vary dramatically; Requires additional parsingMajority of systems are limited in message size; Syslog over UDP often limited to 1024 bytes (RFC 3164);  Fragmentation typically not used with UDP;  Standard MTU is usually 1500 bytes.; Syslog over TCP often limited to 4096 bytesS | 5.113 |
| Windows Events | Microsoft events are stored in proprietary binary format.<br> - Requires Windows Event Viewer or special agent to readNew format is still binary but is XML based<br> - Supports up to 32,766 bytes (syslog UDP is 1,024)<br> - Allows for custom parameters in message sectionEvents are broken up by:<br> - Channels -  A group of logs such as Security or System<br> - Event IDs -  Unique IDs to filter on | 5.114 |
| XML Logs | XML is structured.Â•  Allows for automaticfield extractionÂ•  Requires agent supportTraditional agent:Â•  100+ parsed fieldsÂ•  Modern agent: 1,000s of extracted fields | 5.115 |
| Log Agents | Log agents provide additional functionality.; Auto-parsing; Log rotation; Log buffering; Prioritization; Filtering <br> However, all agents are not created equally.; Performance and functionality vary greatly. | 5.117 |
| Syslog Agents and Windows | Windows events may not fit within the constraints of syslog.<br> - Large events may get truncated.<br> - Or will be Â“choppedÂ” upSyslog-based agents may separate logs into smaller pieces.<br> - Newline character used to break up sections<br> - Last piece without newline distinguishes end of logPutting the pieces back together adds overhead.<br> - As does monitoring for newlines | 5.119 |
| Agentless Log Collection | Agentless involves a central server to collect logs; Server authenticates to systems over WMI or SSH; <br> -Logs are collected in batches.; <br> -Requires admin privileges or additional rights; <br> -Windows 2008+ can use the Event Log Readers group. Main benefit is no additional software; <br> -Do not have to maintain and upgrade agent; <br> -Quicker to deploy and manage | 5.12O | 
| Traditional vs. Network Extraction | Traditional-Multiple collection points, Network Extraction-Single collection point | 5.121 |
| Audit Policies | - Log collection is dependent on proper audit policies.; <br> - Logs must be generated before being collected.; <br> - Default logging settings are insufficient.; <br> - Windows utilizes audit policies to enable logging.; <br> - Linux requires configuration file changes.; <br> - Both support custom logs such as with PowerShell.; <br> - Or third-party programs to add additional logging| 5.124 | 
| Account Management events | Used to track changes to groups, users, and computers; Needed to monitor key groups for modifications; Such as new members added to Domain AdminsPowerful when combined with change control system | 5.125 |
| Object Access | Object access is one of the most misunderstood settings; Such as audit file system it does not log all file access. | 5.126 | 
| Detailed Tracking | Can generate vast amounts of logs-proceed with caution.<br> - Has built-in monitoring of processes<br> -  Default behavior does not include command line logging<br> - Windows 10/Server 2016 also includes plug and play monitoring | 5.127 |
| plug and play devices logging | Another thing worth tracking is new devices being plugged in, such as plug and play devices. Starting with Windows 10 and Server 2016, Microsoft allows logging of plug and play devices. While this, unfortunately, is not available for older operating systems, it is a step in the right direction. | 5.127 |
| Sysmon | Free download from Windows Sysinternals; Written by Mark Russinovich and Thomas Garnier; Runs as a Windows system service and device driver;<br> - Monitors:;  Processes;  Network connections;  Driver and DLL loading;  Raw disk access;  Modifications of file creation times;  Process access;  DNS <br> - Provides process hashes and parent processes for analysis | 5.128 |
| auditd | Provides a customizable Linux Audit system.  <br> - Monitors: File Access, System calls, Program execution, File changes, Security events (such as failed logins), Network access <br> - Granular monitoring allows advanced use casesÂ•   Also, adds complexity and performance overhead | 5.131 |
| Audit Example | PID is process ID of executable, PPID is for parent process <br> - UID is user ID of user <br> - AUID is the audit user ID (tracks actions against logon even if user changes with su or sudo) | 5.132 |
| audit.rules |  Auditd allows for extremely granular monitoring. As a result, it is usually best to plan exactly what needs logging before writing the auditing rules. A general rule of thumb is to try and log only what you intend to actually look at. In the case of auditd, logging everything can have adverse effects on system performance.The audit.rules file is composed of three types of rules: control rules, ilesystem rules, and system call rules. Control rules are used to define configuration settings for the audit system.  | 5.133 | 
| Mitre Att&ck, Detection Engineering | is the process of researching threats and then building and tuning tools that find them.  We need to be able to describe what we want to detect in a structured way so various tools can hunt and find evil. | 5.137 |
| Sigma Generic Signatures |  -Written by Florian Roth and Thomas PatzkeÂ•"To logs, what Snort is to network traffic and YARA is to files" <br> -High-level generic language for analyticsÂ•  Enables analytics reuse and sharing across orgs; MISP compatible - share and store aligned with threat intel <br> -Decouples rule logic from SIEM vendor and field names - Eliminates SIEM tribal knowledge,  Works across SIEM and non-SIEM tools | 5.138 |
| Sigma how it Works | To make Sigma rules work with a SIEM, they must be converted using sigma-cli. The process looks as follows: <br> 1.  Write a rule in Sigma format. <br> 2.  Create a file mapping generic field names to field names within a given SIEM platform. <br> 3.  Use sigma-cli to convert from Sigma format to a specific SIEM product rule format.The process is simple and can be automated with basic scripting skills. | 5.139 | 
| SIGMA, Conversion of Signatures to Alert Queries | slide shows workflow | 5.14O |
| SIGMA Currently Supported Outputs|  SIEM/XDR: -Splunk -QRadar -Cortex XDR -Elasticsearch  -Sentinel One -Carbon Black, etc <br> Endpoint Queries:     Windows Defender Advanced Threat Protection;   PowerShell;   grep | 5.141 |
| Sigma Rule Format | Plaintext YAML files. **Easy schema**: <br> 1.  Metadata; Title, status, description, references, tags, etc. <br> 2. Log source; What type, brand, and service is the log from? <br> 3. Detection; List of selectors<br> 4. Condition; Logic for selector matching | 5.142 |
| Sigma - Title, Metadata, and Log Source | Sigma rules are written in YAML format. The sigma rule in this slide is an example showing that each rule has a title, status, and log source, as well as information about the rule, such as a description and tags. The format allows for ease of readability and customization. | 5.143 |
| SIGMA - Log Source Section | Optional Classifiers: <br> category: proxy, firewall, AV, IDS- For all logs of a group of products <br> product: Squid, pfSense, Symantec, Snort, Windows- For all log outputs of one product  <br> service: SSH, DNS, DHCP- For a subset of a products logs-sshd, named... <br> description: Additional detail on log source, configs | 5.144 | 
| Sigma Detection and Conditions | **Condition:** Logic for rule matching; **Detection:** Object containing items of interest; [field name] - referenced in the condition  | 5.145 |
| Sigma Rules with Sigconverter.io | - The most critical aspect of Sigma rules is the ease of operationalizing them. ; <br> -sigconverter.io, a new web-based converter for Sigma rules that uses pySigma; and the legacy sigmac, since it supports backend languages that aren't yet supported by pySigma. | 5.146 |
| Sigma2attack | Command line tool to generate MITRE heatmap from Sigma; Export heatmap.json; Import into Navigator; Score based onvolume of rules | 5.147 |
| Anomaly Identification vs. Real-Time Alerts | Some MITRE techniques create large quantities of false positives as real-time alerts.  Those signatures work well for threat hunting.A | 5.148 |
| Red Herring | In literature the red herring is a deliberate diversion of attention with the intention of trying to abandon the original argument. <br> - The concept can be applied as a defensive posture .Red herring defenses beneficial in conjunction with an assumption of compromise; <br> - Redirect adversaries to avoid compromise; <br> - Change behavior of automated and malicious tools; <br> - Increase detection while slowing down attacks | 5.152 |
| MITRE Engage and ATT&CK Mappings | - MITRE has released MITRE Engage, a framework for discussing and planning adversary engagement, deception, and denial activities. <br> - Engage is informed by adversary behavior observed in the real world and is intended to drive strategic cyber outcomes. <br> - MITRE Engage maps the various Engagement Activities to ATT&CKÂ®, to ensure that each activity in Engage is driven by observed adversary behavior. | 5.153 |
| Service Banners | Many applications identify their software and version number upon connection. <br> - Attackers and malware use information for exploitation  <br> - Possible to change version, application, or OS identification; May be sufficient to break automated attack tools and scans; Implemented at the local server or with a reverse proxy <br> -     Alternative is to hide or limit informationÂ•May break automated attacks; But less effective | 5.154 |
| Minimizing Service Banners | Services may natively support hiding or limiting service information.<br> -  Apache uses ServerTokens directive; ServerTokens Full (Full or OS default for Apache)<br> -Apache 2.4.18 (Ubuntu) PHP/7.2.2ServerTokens OS<br> -Apache/2.4.18 (Ubuntu)ServerTokens ProductOnly (banner with least info shown)<br> -Apache | 5.155 |
| Changing Service Banners | The alternative is to rewrite or modify the service banner.;  Either done with local software or with reverse proxy;  A reverse proxy has extra benefits. <br> - The real banner can be made visible to select systems/users. <br> - Centralized control and managementTools often target system using service information;  Means attack is unlikely to succeed;  And provides early warning of being targetedC | 5.156 |
| Detection Capabilities | Meaning of detection based on attack source and destination;<br> **External-** Early detection of external threat; Expected true positives (may occur so much as to be noise);<br> **Internal-** Early detection of insider threat; Low false positives and true positives (high fidelity alert) | 5.157 | 
| User-Agents Proxy modification | can be used to protect clients. <br> - User-Agent describes web client application. <br> - Malware uses User-Agent to identify and deliver malicious payloads. <br> - Example: Metasploit Browser Autopwn <br> - Organization may use Google Chrome, but User-Agent can be rewritten as Internet Explorer <br> - Can be applied to any web traffic <br> - Or possibly only to non-allow-listed websites | 5.158 |
| Honeypot | A honeypot is a system designed only to be attacked and monitored.; **High interaction** honeypots use real services.; Often use vulnerable services and hope to be compromised for research; **Low interaction** honeypots emulate services.; Useful as early detection devices |  5.160 | 
| Low Interaction Honeypots | Multiple community projects offer easy to set up honeypotsÂ•Often support multiple low interaction servicesÂ•And centralized management with web management <br> Two modern honeypot frameworks include: <br> **1.  Active Defense Harbinger Distribution (ADHD)** All the best active defense tools in an updated Linux distro <br> 2. T-Pot2 - 20+ honeypots and countless visualizations using Elastic | 5.161 |
| Redirecting to Honeypots | An internal-only honeypot should see more than scans.; Records should pointto honeypot;  Common DNS records;  OS shortcut links;  Web linksUnder normal conditions, a honeypot should not be hit.; Now attacker scans or enumeration identifies them. | 5.162 |
| Honeytokens | Fake objects or content is helpful for identifying unauthorized activity. <br> - *Fake objects or content is referred to as a Honeytoken.; Sometimes referred to as a Canarytoken* <br> - Implementation requires data placement and logging.; Credit card Excel sheet with file auditing; Web bug links with web server's logs; SQL record with stored procedure logging; Fake access credentials in a git repo | 5.163 |
| File Auditing | Automated scripts/malware often used to find patterns <br> - TOP SECRET, social security #, credit card #, etc. <br> - Operate by enumerating and reading through files <br> - Often ignores hidden folders; Enable file auditing using Windows GPO1or Linux auditd. | 5.164 |
| Security Access Token (SAT) Honeytokens | Lateral movement usually from credential compromise; <br> - Security access tokens (SAT) stolen from memory and reused, Mimikatz1is common attack tool to steal credentials <br> Possible to place SAT honeytoken on all systems; Simple method is to run logon script via group policy; MimikatzHoneyToken project available on GitHub2; Or open-source agent/server system available; DCEPT project provide easy-to-rollout agents and server; Creates honeytoken per system to pinpoint compromised asset | 5.165 |
| Auditing Attacker Reconnaissance  | Certain insider threat activitiesare common. Such as: **crawling folders/files** Or finding who is in the** domainadministratorÂ’s group**;  Tactical auditing | 5.166 |
| CanaryTokens.org | thinkst offers a free token service at canarytokens.org.;<br> - Thinkst also provides commercial honeypot solutions.GUI wizards provides walkthrough;<br> - Takes minutes to deploy a token;<br> - Wizard supports unique monitors:; Detect website being cloned; Alert if AWS key or Azure Service Principal certificate is used; Identify if custom binary executed | 5.167 | 
| HALO (Honeytokens against Leveraging OSINT) | Fake users can be created publicly to combat recon.; Could be just in hidden metadata and/or key public sitesExample: Peter Parker (pparker@sec530.com); On LinkedIn, Facebook, Adobe, PGP, GitHub, etc.; Likely to be picked up during OSINT; May eventually make compromised account lists; Takes minimal time to set upÂ… can get fairly elaborateActivity from this account is malicious and provides context. | 5.168 |